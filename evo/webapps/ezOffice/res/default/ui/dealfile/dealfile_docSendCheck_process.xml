<?xml version="1.0" encoding="utf-8"?>
<imag>
	<script>
        <![CDATA[
            var info = $phone.info();
            var fujianwidth='';
            if(info['platform']=='android'){
                 fujianwidth='width:200';
            }
	        var fileindex =0;    //附件最多能上传5个
            var fileAddressArr = new Array();
            var fileTypeArr = new Array();   //附件上传时，存储对应数组fileAddressArr中的类型。pic:图片类型，sound：声音类型，file：其他附件类型
	        
	        function getAttanchNum(){
				if(fileindex>=10){
					hint('上传附件不能超过10个！');
					return false;
				}
				return true;
			}
			function doRelatedAcc(file,appendId,sysname){   
		       	 var menu = $C('<actionmenu cancelTitle="取消">' +
								 '<item style="text-decoration:underline;" label="拍照"     onclick="doFileCamera(this,\'' + appendId + '\',\'' + sysname + '\')"/>' +
								 '<item style="text-decoration:underline;" label="相册照片" onclick="doFilePhotoAlbum(this,\'' + appendId + '\',\'' + sysname + '\')"/>' +
								 '<item style="text-decoration:underline;" label="录音文件" onclick="doFileRecordSound(this,\'' + appendId + '\',\'' + sysname + '\')"/>' +
								 '<item style="text-decoration:underline;" label="其他文件" onclick="doFileBrowse(this,\'' + appendId + '\',\'' + sysname + '\')"/>' +
							'</actionmenu>');
		               menu.show();
		    }
		    function doFilePhotoAlbum(file,appendId,sysname){    //上传文件选择相册
				    if(!getAttanchNum()){
						return;
					}
					$page.browseImage({
						complete: function(path) {
						 	var showpath = path.substring(path.lastIndexOf('/')+1,path.length);
                            var row = $C('<row id="row' + fileindex + '"><icon style="padding-left:20;width:20;height:25;" src="mail_fujian.png"/>'+
						    '<label id="attachmentId' + fileindex + '" style="color:blue;'+fujianwidth+'">' + showpath + '</label>'+
						    '<icon id="imageId" src="mail_del.png" style="width:12;height:12;" onclick="delrow(\'' + fileindex + '\',\'' + appendId + '\');"/></row>');
						    $(appendId).add(row);
						    $('content_form_list').addMore('<imag><list><item style="display:none;"><row><input type="file" style="display:none;" value="' + path + '" name="attachment_main_' + sysname + '"  id="input_file' + fileindex + '"/></row></item></list></imag>');
				            
				        	fileindex++;
				        },
				        error: function() {
				            hint('上传图片失败！');
				        }
					  });
		     }
		 function doFileCamera(file,appendId,sysname) {  //拍照
			if(!getAttanchNum()){
				return;
			}
		    $phone.camera({
		        success: function(path) {
		        	var showpath = path.substring(path.lastIndexOf('/')+1,path.length);
		        	var row = $C('<row id="row' + fileindex + '"><icon style="padding-left:20;width:20;height:25;" src="mail_fujian.png"/>'+
						    '<label id="attachmentId' + fileindex + '" style="color:blue;'+fujianwidth+'">' + showpath + '</label>'+
						    '<icon id="imageId" src="mail_del.png" style="width:12;height:12;" onclick="delrow(\'' + fileindex + '\',\'' + appendId + '\');"/></row>');
						    $(appendId).add(row);
						    $('content_form_list').addMore('<imag><list><item style="display:none;"><row><input type="file" style="display:none;" value="' + path + '" name="attachment_main_' + sysname + '"  id="input_file' + fileindex + '"/></row></item></list></imag>');
				      
		        	fileindex++;
		        },
		        error: function() {
		            hint('拍照失败！');
		        }
		    });
		}
		
		 function doFileRecordSound(file,appendId,sysname) {
			if(!getAttanchNum()){
				return;
			}
		    $phone.recordSound({
		        success: function(path) {
		        	var showpath = path.substring(path.lastIndexOf('/')+1,path.length);
		        	var row = $C('<row id="row' + fileindex + '"><icon style="padding-left:20;width:20;height:25;" src="mail_fujian.png"/>'+
						    '<label id="attachmentId' + fileindex + '" style="color:blue;'+fujianwidth+'">' + showpath + '</label>'+
						    '<icon id="imageId" src="mail_del.png" style="width:12;height:12;" onclick="delrow(\'' + fileindex + '\',\'' + appendId + '\');"/></row>');
						    $(appendId).add(row);
						    $('content_form_list').addMore('<imag><list><item style="display:none;"><row><input type="file" style="display:none;" value="' + path + '" name="attachment_main_' + sysname + '"  id="input_file' + fileindex + '"/></row></item></list></imag>');
				      
		        	fileindex++;
		        },
		        error: function() {
		            hint('录音失败！');
		        }
		    });
		}
		function doFileBrowse(file,appendId,sysname) { //附件上传
				if (!getAttanchNum()) {
					return;
				}
				$page.browse({
					complete: function(path) {
						var showpath = path.substring(path.lastIndexOf('/') + 1, path.length);
						if (showpath.indexOf(".") == -1) {
							hint("无后缀名的附件不允许上传，请重新选择");
							return false;
						}
						var filenameExt = path.substring(path.lastIndexOf('\.')+1,path.length);
			        	if(filenameExt == 'exe'){
			        	    hint("后缀名为exe的附件不允许上传，请重新选择");
			        		return false;
			        	}
			        	if(filenameExt == 'cmd'){
			        	    hint("后缀名为cmd的附件不允许上传，请重新选择");
			        		return false;
			        	}
			        	if(filenameExt == 'jsp'){
			        	    hint("后缀名为jsp的附件不允许上传，请重新选择");
			        		return false;
			        	}
						var row = $C('<row id="row' + fileindex + '"><icon style="padding-left:20;width:20;height:25;" src="mail_fujian.png"/>'+
						'<label id="attachmentId' + fileindex + '" style="color:blue;'+fujianwidth+'">' + showpath + '</label>'+
						'<icon id="imageId" src="mail_del.png" style="width:12;height:12;" onclick="delrow(\'' + fileindex + '\',\'' + appendId + '\');"/></row>');
						$(appendId).add(row);
						//$('input_file'+fileindex).value = path;
						$('content_form_list').addMore('<imag><list><item style="display:none;"><row><input type="file" style="display:none;" value="' + path + '" name="attachment_main_' + sysname + '"  id="input_file' + fileindex + '"/></row></item></list></imag>');
						fileindex++;
					}
				});
			}
			
			function delrow(index,appendId) { //删除附件
				if (confirm('确认删除附件吗？')) {
					$('input_file' + index).value = "";
					$(appendId).remove($('row' + index));
					fileindex--;
				}
			}
		
    ]]>
    </script> 
	<script>
        <![CDATA[
            var fromXml = $param['fromXml'];
            var model = $param['model'];
        	var storage = $phone.localStorage();
        	var evoUrl = storage.getItem('evoUrl');
        	var	workStatus = storage.getItem('workflow_workStatus');
        	var orgId = storage.getItem('sys_orgId');
	        var workId = storage.getItem('workflow_workId');
	        var webServiceUrl = storage.getItem('webServiceUrl');
	        var realFiles;
	        var saveFiles;
	        var isDossier = '';  //是否归档标识
	        var commentAttitudeType = '0';  // 意见态度设置0：默认 1：同意 2：不同意 3；已阅
	        var itemContent = '';
	        // 页面加载完后执行
        	$page.onload = function(){
				$http.progress('正在加载，请稍候...').post(
        			evoUrl + '/ezOffice/dealfile/docSendCheckProcess.do',{workId : workId},
        			function(data){
        				if(!data){
        					alert('数据获取失败！');
        				}
        				data = data.replace(/\&/g,'＆');
        				var jsonData = eval('(' + data + ')');
        				if(jsonData.logonerror && jsonData.logonerror=='1'){
		         			alert("该账号已在设备"+jsonData.deviceId+"上登录");
		          			$page.open('../index.xml',{target:'_self'});
		                    return;
		                }
        				var workInfoResult = jsonData.data_0.message.result;
        				var detailResult = jsonData.data_1.message.result;
        				if(workInfoResult != '1' || detailResult != '1'){
        					alert('数据获取失败！');
        				}
        				var workInfo = jsonData.data_0.data.workInfo;
        				isDossier = workInfo.isDossier == null? '' : workInfo.isDossier;
						var detailData = jsonData.data_1.data;
						var $contentFormList = $('content_form_list');
						//创建流程图
       					createFlowImg(workInfo.flowgraphurl,jsonData.data_2.picRootPath);
       					$('headers').css('display','');
       					// 创建工作流程信息隐藏域
						createWorkInfoHiddenArea(workInfo);
       					// 初始化表单数据
       					createFormData(detailData.baseData,detailData,workInfo,jsonData.data_0.data,workInfo.commentAttitudeTypeSet);
       					$contentFormList.addMore('<imag><list>' + itemContent + '</list></imag>');
       					// 创建附件对象
       					createAttCon();
       					// 创建备用字段附件内容
						createAttachCon();
       					// 创建底部内容
       					createFootContent(workInfo);
       					var backComment = workInfo.backComment;   //退回意见弹出
        				if(backComment!=null&&backComment!=''&&backComment!='[]'){
        				   alert(backComment.replace(/(<[^>]+>)|(&nbsp;)/g,""));
        				}
        			}
        		);
        	}
        	
        	//创建工作流程信息隐藏域
			function createWorkInfoHiddenArea(workInfo){
				// 发送表单提交数据
				$('tableId').value = workInfo.worktable_id;
				$('recordId').value = workInfo.workrecord_id;
				$('activityId').value = workInfo.initactivity;
				$('workId').value = workInfo.wf_work_id;
				$('stepCount').value = workInfo.workstepcount;
				$('actiCommFieldType').value = workInfo.actiCommFieldType;
				$('trantype').value = workInfo.trantype;
				$('isForkTask').value = workInfo.isForkTask;
				$('forkStepCount').value = workInfo.forkStepCount;
				$('forkId').value = workInfo.forkId;
				$('commentField').value = workInfo.commentField;
				$('commentmustnonull').value = workInfo.commentmustnonull;
				$('backnocomment').value = workInfo.backnocomment;
				$('backMailRange').value = workInfo.backMailRange;
				$('smsRight').value = workInfo.smsRight;
				$('worktitle').value = workInfo.worktitle;
				$('workcurstep').value = workInfo.workcurstep;
				$('worksubmittime').value = workInfo.worksubmittime;
				// 退回表单提交数据
				$('back_workId').value = workInfo.wf_work_id;
				$('back_worktitle').value = workInfo.worktitle;
				$('back_workcurstep').value = workInfo.workcurstep;
				$('back_worksubmittime').value = workInfo.worksubmittime;
				$('back_tableId').value = workInfo.worktable_id;
				$('back_recordId').value = workInfo.workrecord_id;
				$('back_stepCount').value = workInfo.workstepcount;
				$('back_forkId').value = workInfo.forkId;
				$('back_forkStepCount').value = workInfo.forkStepCount;
				$('back_isForkTask').value = workInfo.isForkTask;
				$('back_curCommField').value = workInfo.commentField;
				$('back_backWorkProcessId').value = workInfo.workprocess_id;
				$('back_workType').value = workInfo.worktype;
				$('back_workMainLinkFile').value = workInfo.workmainlinkfile;
				$('back_workSubmitPerson').value = workInfo.worksubmitperson;
				$('back_workActivity').value = workInfo.workactivity;
				$('back_standForUserid').value = workInfo.standforuserid;
				$('back_isStandForWork').value = workInfo.isstandforwork;
				
				// 催办/撤办发送表单提交数据
				$('again_workId').value = workInfo.wf_work_id;
				$('again_empLivingPhoto').value = $param['empLivingPhoto'];
				$('again_worktitle').value = workInfo.worktitle;
				$('again_workcurstep').value = workInfo.workcurstep;
				$('again_worksubmittime').value = workInfo.worksubmittime;
			}
			
			// 构建附件内容
			function createAttCon(){
				var attConent = '';
				var accessoryNameseries = '';
				var accessorySaveNameseries = '';
				if(realFiles instanceof Array){
					for(var i=0,length=realFiles.length;i<length;i++){
						if(length-1 > i){
							accessoryNameseries += realFiles[i] + '|';
							accessorySaveNameseries += saveFiles[i] + '|';
						}else{
							accessoryNameseries += realFiles[i];
							accessorySaveNameseries += saveFiles[i];
						}
					}
				}else if(realFiles instanceof Object){
					accessoryNameseries = realFiles.file;
					accessorySaveNameseries = saveFiles.file;
				}
				// 创建下载附件内容
				if(accessoryNameseries && accessorySaveNameseries){
					viewFiles(accessoryNameseries,accessorySaveNameseries,'govdocumentmanager','attachments');
				}
			}
			
			// 创建下载附件内容
			function viewFiles(accessoryNameseries, accessorySaveNameseries, path, appendId) {
				$http.post(evoUrl + '/ezOffice/doc/dealFiles.do', {
					accessoryNameseries: accessoryNameseries,
					accessorySaveNameseries: accessorySaveNameseries,
					path: path
				}, function(data) {
					if (data) {
						var obj = JSON.parse(data);
						if(obj.logonerror && obj.logonerror=='1'){
		         			alert("该账号已在设备"+obj.deviceId+"上登录");
		          			$page.open('../index.xml',{target:'_self'});
		                    return;
		                }
						var attList = obj.attList;
						if (!attList == '') { //不为空，数据进行迭代,并为附件赋值
							for (var k = 0; k < attList.length; k++) {
								 var files = "";
			                     var fileType = attList[k].savename.substr(attList[k].savename.lastIndexOf(".")).replace(/<[^>]+>/g,'').toLowerCase();
			                     if(fileType.toLowerCase() != '.xls' && fileType.toLowerCase() != '.xlsx'     //直接下载
									&& fileType.toLowerCase() != '.doc' && fileType.toLowerCase() != '.docx' 
									&& fileType.toLowerCase() != '.ppt' && fileType.toLowerCase() != '.pptx' 
									&& fileType.toLowerCase() != '.rtf' && fileType.toLowerCase() != '.eio'
									&& fileType.toLowerCase() != '.txt' && fileType.toLowerCase() != '.jpg'
									&& fileType.toLowerCase() != '.png' && fileType.toLowerCase() != '.gif'
									&& fileType.toLowerCase() != '.jpeg' && fileType.toLowerCase() != '.bmp'){
			                      	 files = $C('<row style="margin-bottom:5"><icon src="mail_fujian.png" style="align:left;width:16;height:16"></icon><label style="color:#38adff;text-decoration:underline;align:left;font-size:16;margin-left:5"  onclick="$http.download(\''+evoUrl+'/ezOffice/download/file.do?url='+attList[k].attachurlser+'&amp;filename='+attList[k].savename+'&amp;uploadPath='+path+'&amp;viewName='+attList[k].realname+'\')">'+attList[k].realname+'</label></row>');
			                      }else{
			                     	  files = $C('<row style="margin-bottom:5"><icon src="mail_fujian.png" style="align:left;width:16;height:16"></icon><label style="color:#38adff;text-decoration:underline;align:left;font-size:16;margin-left:5;"  onclick="convertFileToHtml(\''+attList[k].savename+'\',\''+attList[k].realname+'\',\''+path+'\')">'+attList[k].realname+'</label></row>');
								  }
								  $(appendId).add(files);
							}
						} else { //无附件，或者后台处理异常
			
						}
					}
				},function(error) {
				    if (error == 'timeout') {
						hint('连接服务器超时！');
				    } else if (error == '404') {
						hint('链接超时重新登录！');
				    } else if (error == '500') {
						hint('内部服务器错误！');
				    } else {
						hint('访问网络错误！错误代码:' + error);
				    }
				    $page.open('../index.xml',{animation:'down-to-up'});
				  });
			}
			
			 function convertFileToHtml(fileName,menuName,path){   //高清wordToSvgHtml  普通wordToHtml
	         	 var fileType = fileName.substr(fileName.lastIndexOf(".")).replace(/<[^>]+>/g,'').toLowerCase();
                 if(fileType.toLowerCase() != '.xls' && fileType.toLowerCase() != '.xlsx'
					&& fileType.toLowerCase() != '.doc' && fileType.toLowerCase() != '.docx' 
					&& fileType.toLowerCase() != '.ppt' && fileType.toLowerCase() != '.pptx' 
					&& fileType.toLowerCase() != '.rtf' && fileType.toLowerCase() != '.eio'
					&& fileType.toLowerCase() != '.txt' && fileType.toLowerCase() != '.jpg'
					&& fileType.toLowerCase() != '.png' && fileType.toLowerCase() != '.gif'
					&& fileType.toLowerCase() != '.jpeg' && fileType.toLowerCase() != '.bmp'){
				    alert("该类型不支持预览，请于电脑端查看！");
				    return;
			     }
            	 $http.progress('预览中，请稍后...').post(evoUrl+'/ezOffice/fileView/fileConvert.do',
	              {path:path,convertType:'wordToSvgHtml','fileName':fileName},
	              function(data) {
		               if(data == '1'){
		               		 var menuAction = '';
		               		 var fileLength = fileName.length;
		               		 if(fileType.toLowerCase() == '.jpg' || fileType.toLowerCase() == '.png' || fileType.toLowerCase() == '.gif' || 
									fileType.toLowerCase() == '.jpeg' || fileType.toLowerCase() == '.bmp'){
									 menuAction = evoUrl+'/ezOffice/upload/'+path+'/'+fileName;
		               		 }else{
		               		 	    menuAction = evoUrl+'/ezOffice/upload/'+path+'/'+fileName.substring(0,fileName.lastIndexOf('.'))+'svg.html';
		               		 }
		              		$page.open('../custmenu/cust_url.xml?menuAction='+encodeURIComponent(menuAction)+'&menuName='+encodeURIComponent(menuName), {animation:'down-to-up'});
		               }else{
		               		alert("预览失败，请重新预览！");
		               }
		            },function(error) {
		            	if (error == 'timeout') {
					        hint('连接服务器超时！');
					    } else if (error == '404') {
					        hint('页面不存在！');
					    } else if (error == '500') {
					        hint('内部服务器错误！');
					    } else {
					        hint('访问网络错误！错误代码:' + error);
					    }
					    $page.open('../index.xml',{animation:'down-to-up'});
					});
            }
        
	        //全屏查看
	        function fullScreenBrowse(){
				var flowgraphurl =$('flowgraphurl').value;
				storage.setItem('flowgraphurl',flowgraphurl);
				$page.open('dealfile_viewBigPic.xml',{target:'_blank'});
	        }
	        
	        // 需要创建附件下载内容的数组
	        var attachmentArray = new Array();
	        
	        // 创建附件下载内容
	        function createAttachCon(){
	        	var attachments;
	        	var path = 'govdocumentmanager';
	        	attachmentArray.map(function(attachmentInfo){
	        		attachments = attachmentInfo.split(';');
					$http.post(evoUrl + '/ezOffice/doc/dealFiles.do', {
						accessoryNameseries : attachments[1].replace(/,/g,'|'),
						accessorySaveNameseries : attachments[0].replace(/,/g,'|'),
						path : 'govdocumentmanager'
					}, function(data) {
						if (data) {
							var obj = JSON.parse(data);
							if(obj.logonerror && obj.logonerror=='1'){
			         			alert("该账号已在设备"+obj.deviceId+"上登录");
			          			$page.open('../index.xml',{target:'_self'});
			                    return;
			                }
							var attList = obj.attList;
							var attachIdArr = attachmentInfo.split(';');  //解决异步提交时，会造成获取的attachIdArr不是请求的那个。后面的数组元素会覆盖前面的数组元素。
							if (!attList == '') { //不为空，遍历,并为附件赋值
								for (var k = 0; k < attList.length; k++) {
									 var files = "";
			                     	 var fileType = attList[k].savename.substr(attList[k].savename.lastIndexOf(".")).replace(/<[^>]+>/g,'').toLowerCase();
				                     if(fileType.toLowerCase() != '.xls' && fileType.toLowerCase() != '.xlsx'     //直接下载
										&& fileType.toLowerCase() != '.doc' && fileType.toLowerCase() != '.docx' 
										&& fileType.toLowerCase() != '.ppt' && fileType.toLowerCase() != '.pptx' 
										&& fileType.toLowerCase() != '.rtf' && fileType.toLowerCase() != '.eio'
										&& fileType.toLowerCase() != '.txt' && fileType.toLowerCase() != '.jpg'
										&& fileType.toLowerCase() != '.png' && fileType.toLowerCase() != '.gif'
										&& fileType.toLowerCase() != '.jpeg' && fileType.toLowerCase() != '.bmp'){
				                      	 files = $C('<row style="margin-bottom:5"><icon src="mail_fujian.png" style="align:left;width:16;height:16"></icon><label style="color:#38adff;text-decoration:underline;align:left;font-size:16;margin-left:5"  onclick="$http.download(\''+evoUrl+'/ezOffice/download/file.do?url='+attList[k].attachurlser+'&amp;filename='+attList[k].savename+'&amp;uploadPath='+path+'&amp;viewName='+attList[k].realname+'\')">'+attList[k].realname+'</label></row>');
				                      }else{
				                      	 // files = $C('<row style="margin-bottom:5"><label style="color:#38adff;align:left;font-size:16;margin-left:5;margin-right:5;" onclick="convertFileToHtml(\''+attList[k].savename+'\',\''+attList[k].realname+'\',\''+path+'\')">预览</label><icon src="mail_fujian.png" style="align:left;width:16;height:16"></icon><label style="color:#38adff;text-decoration:underline;align:left;font-size:16;margin-left:5;"  onclick="$http.download(\''+evoUrl+'/ezOffice/download/file.do?url='+attList[k].attachurlser+'&amp;filename='+attList[k].savename+'&amp;uploadPath='+path+'&amp;viewName='+attList[k].realname+'\')">'+attList[k].realname+'</label></row>');
				                     	  files = $C('<row style="margin-bottom:5"><icon src="mail_fujian.png" style="align:left;width:16;height:16"></icon><label style="color:#38adff;text-decoration:underline;align:left;font-size:16;margin-left:5;"  onclick="convertFileToHtml(\''+attList[k].savename+'\',\''+attList[k].realname+'\',\''+path+'\')">'+attList[k].realname+'</label></row>');
									  }
									  $(attachIdArr[2]).add(files);
								}
							} else { //无附件，或者后台处理异常
								alert('附件下载失败！');
							}
						}
					},function(error) {
				    if (error == 'timeout') {
						hint('连接服务器超时！');
				    } else if (error == '404') {
						hint('链接超时重新登录！');
				    } else if (error == '500') {
						hint('内部服务器错误！');
				    } else {
						hint('访问网络错误！错误代码:' + error);
				    }
				    $page.open('../index.xml',{animation:'down-to-up'});
				  });
	        	});
	        }
        
        	//初始化送审签表单数据
	        function createFormData(govDocDetail,detailData,workInfo,workInfoData,commentAttitudeTypeSet){
	            var commentList = workInfoData.commentList;   //已办审批意见列表
	            var workcurstep = workInfoData.workInfo.workcurstep;    //当前审批意见名称
	            for(var key in govDocDetail) {
		        	if(key=='sendFileCheckTitle'&&govDocDetail.sendFileCheckTitle){
		        		itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">'+govDocDetail.sendFileCheckTitle.name+':</label>'+
		        				   '</row></col><col style="margin:10;padding:10;"><row><label style="color:#555555">'+(govDocDetail.sendFileCheckTitle.text == undefined ? '' : govDocDetail.sendFileCheckTitle.text)+'</label></row></col></item>';
		        	}
		        	if(key=='sendFileCheckComeUnit'&&govDocDetail.sendFileCheckComeUnit){
		        		itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">'+govDocDetail.sendFileCheckComeUnit.name+':</label>'+
		        				   '</row></col><col style="margin:10;padding:10;"><row><label style="color:#555555">'+(govDocDetail.sendFileCheckComeUnit.text == undefined ? '' : govDocDetail.sendFileCheckComeUnit.text)+'</label></row></col></item>';
		        	}
		        	if(key=='field1'&&govDocDetail.field1){
						itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">'+govDocDetail.field1.name+':</label>'+
		        				   '</row></col>';
		        		var fieldDisplayType = govDocDetail.field1.fieldDisplayType;
		        		if(fieldDisplayType == '13' || fieldDisplayType == '14' || fieldDisplayType == '17'){
		        			if(govDocDetail.field1.text && govDocDetail.field1.text.length > 0){
			        			attachmentArray.push(govDocDetail.field1.text + ';field1');
		        			}
		        			itemContent += '<col id="field1" style="margin:10;padding:10;"></col></item>';
		        		}else{
		        			itemContent += '<col style="margin:10;padding:10;"><row><label style="color:#555555">'+(govDocDetail.field1.text == undefined ? '' : govDocDetail.field1.text)+'</label>'+
		        				   		   '</row></col></item>';
		        		}
		        	}
		        	if(key=='field2'&&govDocDetail.field2){
						itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">'+govDocDetail.field2.name+':</label>'+
		        				   '</row></col>';
		        		var fieldDisplayType = govDocDetail.field2.fieldDisplayType;
		        		if(fieldDisplayType == '13' || fieldDisplayType == '14' || fieldDisplayType == '17'){
		        			if(govDocDetail.field2.text && govDocDetail.field2.text.length > 0){
			        			attachmentArray.push(govDocDetail.field2.text + ';field2');
		        			}
		        			itemContent += '<col id="field2" style="margin:10;padding:10;"></col></item>';
		        		}else{
		        			itemContent += '<col style="margin:10;padding:10;"><row><label style="color:#555555">'+(govDocDetail.field2.text == undefined ? '' : govDocDetail.field2.text)+'</label>'+
		        				   		   '</row></col></item>';
		        		}
		        	}
		        	if(key=='field3'&&govDocDetail.field3){
						itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">'+govDocDetail.field3.name+':</label>'+
		        				   '</row></col>';
		        		var fieldDisplayType = govDocDetail.field3.fieldDisplayType;
		        		if(fieldDisplayType == '13' || fieldDisplayType == '14' || fieldDisplayType == '17'){
		        			if(govDocDetail.field3.text && govDocDetail.field3.text.length > 0){
			        			attachmentArray.push(govDocDetail.field3.text + ';field3');
		        			}
		        			itemContent += '<col id="field3" style="margin:10;padding:10;"></col></item>';
		        		}else{
		        			itemContent += '<col style="margin:10;padding:10;"><row><label style="color:#555555">'+(govDocDetail.field3.text == undefined ? '' : govDocDetail.field3.text)+'</label>'+
		        				   		   '</row></col></item>';
		        		}
		        	}
		        	if(key=='field4'&&govDocDetail.field4){
						itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">'+govDocDetail.field4.name+':</label>'+
		        				   '</row></col>';
		        		var fieldDisplayType = govDocDetail.field4.fieldDisplayType;
		        		if(fieldDisplayType == '13' || fieldDisplayType == '14' || fieldDisplayType == '17'){
		        			if(govDocDetail.field4.text && govDocDetail.field4.text.length > 0){
			        			attachmentArray.push(govDocDetail.field4.text + ';field4');
		        			}
		        			itemContent += '<col id="field4" style="margin:10;padding:10;"></col></item>';
		        		}else{
		        			itemContent += '<col style="margin:10;padding:10;"><row><label style="color:#555555">'+(govDocDetail.field4.text == undefined ? '' : govDocDetail.field4.text)+'</label>'+
		        				   		   '</row></col></item>';
		        		}
		        	}
		        	if(key=='field5'&&govDocDetail.field5){
						itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">'+govDocDetail.field5.name+':</label>'+
		        				   '</row></col>';
		        		var fieldDisplayType = govDocDetail.field5.fieldDisplayType;
		        		if(fieldDisplayType == '13' || fieldDisplayType == '14' || fieldDisplayType == '17'){
		        			if(govDocDetail.field5.text && govDocDetail.field5.text.length > 0){
			        			attachmentArray.push(govDocDetail.field5.text + ';field5');
		        			}
		        			itemContent += '<col id="field5" style="margin:10;padding:10;"></col></item>';
		        		}else{
		        			itemContent += '<col style="margin:10;padding:10;"><row><label style="color:#555555">'+(govDocDetail.field5.text == undefined ? '' : govDocDetail.field5.text)+'</label>'+
		        				   		   '</row></col></item>';
		        		}
		        	}
		        	if(key=='field6'&&govDocDetail.field6){
						itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">'+govDocDetail.field6.name+':</label>'+
		        				   '</row></col>';
		        		var fieldDisplayType = govDocDetail.field6.fieldDisplayType;
		        		if(fieldDisplayType == '13' || fieldDisplayType == '14' || fieldDisplayType == '17'){
		        			if(govDocDetail.field6.text && govDocDetail.field6.text.length > 0){
			        			attachmentArray.push(govDocDetail.field6.text + ';field6');
		        			}
		        			itemContent += '<col id="field6" style="margin:10;padding:10;"></col></item>';
		        		}else{
		        			itemContent += '<col style="margin:10;padding:10;"><row><label style="color:#555555">'+(govDocDetail.field6.text == undefined ? '' : govDocDetail.field6.text)+'</label>'+
		        				   		   '</row></col></item>';
		        		}
		        	}
		        	if(key=='field7'&&govDocDetail.field7){
						itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">'+govDocDetail.field7.name+':</label>'+
		        				   '</row></col>';
		        		var fieldDisplayType = govDocDetail.field7.fieldDisplayType;
		        		if(fieldDisplayType == '13' || fieldDisplayType == '14' || fieldDisplayType == '17'){
		        			if(govDocDetail.field7.text && govDocDetail.field7.text.length > 0){
			        			attachmentArray.push(govDocDetail.field7.text + ';field7');
		        			}
		        			itemContent += '<col id="field7" style="margin:10;padding:10;"></col></item>';
		        		}else{
		        			itemContent += '<col style="margin:10;padding:10;"><row><label style="color:#555555">'+(govDocDetail.field7.text == undefined ? '' : govDocDetail.field7.text)+'</label>'+
		        				   		   '</row></col></item>';
		        		}
		        	}
		        	if(key=='field8'&&govDocDetail.field8){
						itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">'+govDocDetail.field8.name+':</label>'+
		        				   '</row></col>';
		        		var fieldDisplayType = govDocDetail.field8.fieldDisplayType;
		        		if(fieldDisplayType == '13' || fieldDisplayType == '14' || fieldDisplayType == '17'){
		        			if(govDocDetail.field8.text && govDocDetail.field8.text.length > 0){
			        			attachmentArray.push(govDocDetail.field8.text + ';field8');
		        			}
		        			itemContent += '<col id="field8" style="margin:10;padding:10;"></col></item>';
		        		}else{
		        			itemContent += '<col style="margin:10;padding:10;"><row><label style="color:#555555">'+(govDocDetail.field8.text == undefined ? '' : govDocDetail.field8.text)+'</label>'+
		        				   		   '</row></col></item>';
		        		}
		        	}
		        	if(key=='field9'&&govDocDetail.field9){
						itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">'+govDocDetail.field9.name+':</label>'+
		        				   '</row></col>';
		        		var fieldDisplayType = govDocDetail.field9.fieldDisplayType;
		        		if(fieldDisplayType == '13' || fieldDisplayType == '14' || fieldDisplayType == '17'){
		        			if(govDocDetail.field9.text && govDocDetail.field9.text.length > 0){
			        			attachmentArray.push(govDocDetail.field9.text + ';field9');
		        			}
		        			itemContent += '<col id="field9" style="margin:10;padding:10;"></col></item>';
		        		}else{
		        			itemContent += '<col style="margin:10;padding:10;"><row><label style="color:#555555">'+(govDocDetail.field9.text == undefined ? '' : govDocDetail.field9.text)+'</label>'+
		        				   		   '</row></col></item>';
		        		}
		        	}
		        	if(key=='field10'&&govDocDetail.field10){
						itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">'+govDocDetail.field10.name+':</label>'+
		        				   '</row></col>';
		        		var fieldDisplayType = govDocDetail.field10.fieldDisplayType;
		        		if(fieldDisplayType == '13' || fieldDisplayType == '14' || fieldDisplayType == '17'){
		        			if(govDocDetail.field10.text && govDocDetail.field10.text.length > 0){
			        			attachmentArray.push(govDocDetail.field10.text + ';field10');
		        			}
		        			itemContent += '<col id="field10" style="margin:10;padding:10;"></col></item>';
		        		}else{
		        			itemContent += '<col style="margin:10;padding:10;"><row><label style="color:#555555">'+(govDocDetail.field10.text == undefined ? '' : govDocDetail.field10.text)+'</label>'+
		        				   		   '</row></col></item>';
		        		}	
		        	}
	        	}
	        	//正文
	        	var saveFileIsExitst = detailData.docSaveFile+"";
	        	if(saveFileIsExitst!=""){   
	        	        var docSaveFileArr = detailData.docSaveFile;
	        	        var docRealFileArr = detailData.docRealFile;
	        	        if(docSaveFileArr instanceof Array){
	        	            for(var j=0;j<docSaveFileArr.length;j++){
	        	            	if(j<docSaveFileArr.length-1){
			        	            filename += docSaveFileArr[j]+"|";
				        		    displayName += docRealFileArr[j].text+"|";
			        	        }else if(j==docSaveFileArr.length-1){
			        	            filename += docSaveFileArr[j];
				        		    displayName += docRealFileArr[j].text;
			        	        }
				        	}
				        	if(detailData.docRealFile[0].canEdit=='true'){
			        			isEdit = '1';
			        		}	
	        	        }else{
			        		filename = detailData.docSaveFile.file;
			        		displayName = detailData.docRealFile.file.text;
			        		if(detailData.docRealFile.file.canEdit=='true'){
			        			isEdit = '1';
			        		}
			        	}
			        	itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">正文:</label>'+
			        				   '</row></col><col style="margin:10;padding:10;" id="docContent"></col></item>';
		        }
	        	
	        	// 附件表单
	        	if(detailData.realFile){
	        		if(detailData.realFile.file){
	        			if(detailData.realFile.file.length<=0){
	        				itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">附件:</label>'+
	        				   '</row></col><col id="attachments"  style="margin:10;padding:10;"></col></item>';
	        			}else{
	        				realFiles = detailData.realFile;
	        				saveFiles = detailData.saveFile;
	        				itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">附件:</label>'+
	        				   '</row></col><col id="attachments"  style="margin:10;padding:10;"></col></item>';
	        			}
	        		}else{
	        			realFiles = detailData.realFile;
	        			saveFiles = detailData.saveFile;
	        			itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">附件:</label>'+
	        				   '</row></col><col id="attachments"  style="margin:10;padding:10;"></col></item>';
	        		}
	        	}
 				
 				// 自定义字段集合批示意见
	        	if(govDocDetail.custemFieldList){
	        		var custemFieldList = govDocDetail.custemFieldList;
		        	if(custemFieldList instanceof Array){
		        		for(var i=0,length=custemFieldList.length;i<length;i++){
			        		itemContent += createCustemFieldCon(custemFieldList[i],i+'');
		        		}
		        	}else if(custemFieldList instanceof Object){
		        		itemContent += createCustemFieldCon(custemFieldList.custemField,'0');
		        	}
	        	}
 				
	        	//已经批示的意见
	        	if(commentList){
	        		//var commentList = govDocDetail.commentList;
	        		var commentType = '';
	        		var commentShouxie = '';
					var commentYuyin = '';
		        	if(commentList instanceof Array){
		        		for(var i=0,length=commentList.length;i<length;i++){
			        	//	itemContent += createCommentCon(commentList[i],detailData.curCommField,workcurstep);
			        	    itemContent += createCommentCon(commentList[i]);
		        		}
		        	}else if(commentList instanceof Object){
		        	//	    itemContent += createCommentCon(commentList,detailData.curCommField,detailData.workcurstep);
		        			itemContent += createCommentCon(commentList.comment);  //非数组与数组返回的格式不一样
		        	}
	        	}
	        	
	        	// 批示意见对应字段workInfo.commentField
	        	if(workStatus == '2'){  //阅件批示意见
			    	var workInfo = workInfoData.workInfo ;
			    	var passRoundCommFieldName = workInfo.passRoundCommFieldName;
			 		var commentViewName = '';
			        var  workcurstep =  workInfo.workcurstep;
				    if(passRoundCommFieldName == '' || passRoundCommFieldName == null){
				    	commentViewName = workcurstep ;
				    }else{
				    	commentViewName = passRoundCommFieldName;
				    }
			    	itemContent += '<item style="padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;">';
	        	    itemContent += '<row><label style="align:left;font-size:16;color:#555555">'+commentViewName+':</label></row></col></item><item style="padding:0;margin:0;"><col>';
	        		itemContent += '<row><textarea rows="5" maxrows="5" name="comment_input" id="comment_input"></textarea></row>'+
	        			          '<row><label style=""></label><radio name="commentradio" value="1" checked="false" onclick="$(\'comment_input\').value=\'同意。\'">同意</radio><label style="width:10"></label><label style=""></label><radio onclick="$(\'comment_input\').value=\'已阅。\'" name="commentradio" value="0">已阅</radio></row>';
	        	    itemContent += '</col></item>';
			    }else if(workStatus != '102' && workStatus != '101'&& workInfoData.workInfo.commentField != '-1'&&workInfoData.workInfo.commentField != '' && workInfoData.workInfo.commentField != 'nullCommentField'&& workInfoData.workInfo.commentField != '-1'){
			    	var workInfo = workInfoData.workInfo ;    //其他批示，待办
			    	var commentFieldName = workInfo.commentFieldName;
				    var commentViewName = '';
				    var commentField = workInfo.commentField;
				    var  workcurstep =  workInfo.workcurstep;
				    if(commentFieldName == '' || commentFieldName == null){
				    	commentViewName = workcurstep ;
				    }else{
				    	commentViewName = commentFieldName;
				    }
	        	    itemContent += '<item style="padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;">';
	        	    itemContent += '<row><label style="align:left;font-size:16;color:#555555">'+commentViewName+':</label></row></col></item><item style="padding:0;margin:0;"><col>';
	        		itemContent += '<row><textarea rows="5" maxrows="5" name="comment_input" id="comment_input"></textarea></row>';
	        		if(commentAttitudeTypeSet&&commentAttitudeTypeSet=='1'){   
						itemContent +='<row><label style=""></label><radio name="commentradio" value="1" checked="false" onclick="commentAttitudeType = \'1\';">同意</radio><label style="width:10"></label><radio onclick="commentAttitudeType = \'2\';" name="commentradio" value="0">不同意</radio></row>';
					}else if(commentAttitudeTypeSet&&commentAttitudeTypeSet=='2'){
						itemContent +='<row><label style=""></label><radio onclick="commentAttitudeType = \'3\';" name="commentradio" value="0">已阅</radio><label style="width:10"></label><radio name="commentradio" value="1" checked="false" onclick="commentAttitudeType = \'1\';">同意</radio><label style="width:10"></label><radio onclick="commentAttitudeType = \'2\';" name="commentradio" value="0">不同意</radio></row>';
					}
	        	    itemContent += '</col></item>';
	        	}
	        }

	        // 构建自定义字段内容
			function createCustemFieldCon(field,cusIndex){
				var mustfilled = field.mustfilled;
				var mustfilled_view = '';
        	    if(mustfilled && mustfilled=='1'){
        	       mustfilled_view = '<label style="align:left;font-size:12;color:#FF4617">*</label>';
        	    }
				var custemCon = '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view;
				custemCon += '<label style="align:left;font-size:16;color:#555555">'+field.name+':</label></row></col><col style="margin:10;padding:10;" id="cusFile_'+cusIndex+'">';
				var content = field.content;
				var showType = field.displayType;
				var readWrite = field.readwrite;
				//单行文本
				if(showType == '101' && readWrite == '1'){
					var fieldType = field.fieldtype;
					if(fieldType == '1000000'){
	        			custemCon += '<row><input style="font-size:16;color:#555555" id="_main_' + field.fieldname + '" type="number" name="_main_' + field.fieldname + '" value="' + field.content + '" maxlength="9" /></row>';
	        		}else if(fieldType == '1000001'){
	        			custemCon += '<row><input style="font-size:16;color:#555555" id="_main_' + field.fieldname + '" type="number" name="_main_' + field.fieldname + '" value="' + field.content + '" maxlength="18"/></row>';
	        		}else{
	        			custemCon += '<row><input style="font-size:16;color:#555555" id="_main_' + field.fieldname + '" type="text" name="_main_' + field.fieldname + '" value="' + field.content + '"/></row>';
	        		}
	        		pushMustFillArray(mustfilled,field.name,'_main_' + field.fieldname);
				//单选
				}else if(showType == '103' && readWrite == '1'){
					var selectContent = '<row><select style="align:right;font-size:16;" id="_main_' + field.fieldname + '" name="_main_' + field.fieldname + '">'+
	        			'<option value="">请选择</option>';
	        		var dataListIsFlag = field.dataListIsFlag;
	        		if(dataListIsFlag =='1'){
	        			for(var index=0,size=field.dataList.length;index<size;index++){
			        		if(content){
				        		if(content == field.dataList[index].hiddenval){
				        			selectContent += '<option selected="true" value="'+field.dataList[index].hiddenval+'">'+field.dataList[index].showval+'</option>';
				        		}else{
				        			selectContent += '<option value="'+field.dataList[index].hiddenval+'">'+field.dataList[index].showval+'</option>';
				        		}
			        		}else{
			        			selectContent += '<option value="'+field.dataList[index].hiddenval+'">'+field.dataList[index].showval+'</option>';
			        		}
		        		}
	        		}
	        		selectContent += '</select>';
	        		custemCon += selectContent + '</row>';
	        		pushMustFillArray(mustfilled,field.name,'_main_' + field.fieldname);
				//多选
				}else if(showType == '104' && readWrite == '1'){
					var selectContent = '';
	        		var dataListIsFlag = field.dataListIsFlag;
	        		if(dataListIsFlag =='1'){
	        			for(var index=0,size=field.dataList.length;index<size;index++){
		        		    selectContent += '<row>';
			        		if(content){
								if((content + ',').indexOf(field.dataList[index].hiddenval + ',') > -1){
				        			selectContent += '<checkbox style="align:left;font-size:16;" checked="true" id="_main_' + field.fieldname +index+ '" name="_main_' + field.fieldname + '" value="'+field.dataList[index].hiddenval+',">'+field.dataList[index].showval+'</checkbox>';
				        		}else{
				        			selectContent += '<checkbox style="align:left;font-size:16;" id="_main_' + field.fieldname +index+ '" name="_main_' + field.fieldname + '" value="'+field.dataList[index].hiddenval+',">'+field.dataList[index].showval+'</checkbox>';
				        		}
			        		}else{
			        			selectContent += '<checkbox style="align:left;font-size:16;" id="_main_' + field.fieldname +index+ '" name="_main_' + field.fieldname + '" value="'+field.dataList[index].hiddenval+',">'+field.dataList[index].shownval+'</checkbox>';
			        		}
			        		selectContent += '</row>';
		        		}
	        		}
	        		custemCon += selectContent;
	        		pushMustFillCheckboxArray(mustfilled,field.name,'_main_' + field.fieldname,field.dataList.length);
				//下拉框
				}else if(showType == '105' && readWrite == '1'){
					var selectContent = '<row><select style="align:right;font-size:16;" id="_main_' + field.fieldname + '" name="_main_' + field.fieldname + '">'+
	        			'<option value="">请选择</option>';
	        		var dataListIsFlag = field.dataListIsFlag;
	        		if(dataListIsFlag =='1'){
	        			for(var index=0,size=field.dataList.length;index<size;index++){
			        		if(content){
				        		if(content == field.dataList[index].hiddenval){
				        			selectContent += '<option selected="true" value="'+field.dataList[index].hiddenval+'">'+field.dataList[index].showval+'</option>';
				        		}else{
				        			selectContent += '<option value="'+field.dataList[index].hiddenval+'">'+field.dataList[index].showval+'</option>';
				        		}
			        		}else{
			        			selectContent += '<option value="'+field.dataList[index].hiddenval+'">'+field.dataList[index].showval+'</option>';
			        		}
		        		}
	        		}
	        		selectContent += '</select>';
	        		custemCon += selectContent + '</row>';
	        		pushMustFillArray(mustfilled,field.name,'_main_' + field.fieldname);
				//日期
				}else if(showType == '107' && readWrite == '1'){
					custemCon += '<row><input style="color:#555555;font-size:16;" type="date" id="_main_' + field.fieldname + '" name="_main_' + field.fieldname + '" value="' + field.content + '"/></row>';
	        		pushMustFillArray(mustfilled,field.name,'_main_' + field.fieldname);
				//时间 
				}else if(showType == '108' && readWrite == '1'){
	        		custemCon += '<row><input style="color:#555555;font-size:16;" type="time" id="_main_' + field.fieldname + '" name="_main_' + field.fieldname + '" value="' + field.content + '"/></row>';
	        		pushMustFillArray(mustfilled,field.name,'_main_' + field.fieldname);
	        	//日期 时间 
	        	}else if(showType == '109' && readWrite == '1'){
	        		custemCon += '<row><input style="color:#555555;font-size:16;" type="datetime" id="_main_' + field.fieldname + '" name="_main_' + field.fieldname + '" value="' + field.content + '"/></row>';
	        		pushMustFillArray(mustfilled,field.name,'_main_' + field.fieldname);
	        	//多行文本
	        	}else if(showType == '110' && readWrite == '1'){
	        		custemCon += '<row><textarea style="color:#555555;font-size:16;" rows="5" maxrows="5" id="_main_' + field.fieldname + '" name="_main_' + field.fieldname + '">' + field.content + '</textarea></row>';
	        		pushMustFillArray(mustfilled,field.name,'_main_' + field.fieldname);
	        	//附件上传
	        	}else if(showType == '115'){
	        		if(readWrite == '1'){
		        		var fuItem='';
		        		var attId = 'cusFile_'+cusIndex;
		        		if(content !=''){
			        		attachmentArray.push(content+';cusFile_'+cusIndex+';customform');
		        		}else{
		        			content='';
		        		}
		        		fuItem += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row><label style="align:left;font-size:16;color:#555555">' + field.name + ':</label>'+
		        		'<input type="hidden" name="_mainfile_' + field.fieldname + '" value="' + content.replace(/&/g,'&amp;') + '"/></row></col><col id="' + attId + '" style="padding:10;margin:10;">';
		        		fuItem += '<row id="fileRow" onclick="doRelatedAcc(this,\'' + attId + '\',\'' + field.fieldname + '\')"><icon src="mail_addfu.png" style="width:28;height:28;" onclick="doRelatedAcc(this,\'' + attId + '\',\'' + field.fieldname + '\')"/></row>';
		        		fileindex++;
		        		custemCon = fuItem;
	        		}else{
	        			if(content !=''){
					    	attachmentArray.push(content+';cusFile_'+cusIndex+';customform');
					    }
	        		}
	        	//Word编辑	
	        	}else if(showType == '116'){
				    if(content !=''){
				    	attachmentArray.push(content+'.doc;正文;cusFile_'+cusIndex+';information');
				    }else if(readWrite == '1'){
				    	custemCon += '<row><label style="align:left;font-size:12;color:#FF4617">该字段暂不支持手机办理，请于电脑端操作...</label></row>';
				    }
	        	//Excel编辑
	        	}else if(showType == '117'){
	        		if(content !=''){
				    	attachmentArray.push(content+'.xls;正文;cusFile_'+cusIndex+';information');
				    }else if(readWrite == '1'){
				    	custemCon += '<row><label style="align:left;font-size:12;color:#FF4617">该字段暂不支持手机办理，请于电脑端操作...</label></row>';
				    }
	        		
	        	//WPS编辑 118
	        	}else if(showType == '118'){
	        		if(content !=''){
				    	attachmentArray.push(content+'.wps;正文;cusFile_'+cusIndex+';information');
				    }else if(readWrite == '1'){
				    	custemCon += '<row><label style="align:left;font-size:12;color:#FF4617">该字段暂不支持手机办理，请于电脑端操作...</label></row>';
				    }
	        	//单选人 全部	
	        	}else if(showType == '210' && readWrite == '1'){
	        		var contId='';
	        		var contName='';
	        		if(content && content.indexOf(";")>-1){
				    	var cons = content.split(";");
				    	contName=cons[0];
				    	contId=cons[1];
				    }
	        		custemCon += '<row onclick="selectUser(\'_mainId_' + field.fieldname +'\',\'_mainShow_' + field.fieldname +'\',\'_main_' + field.fieldname +'\',\'*0*\',\'0\')">'+
	        					   '<input onclick="selectUser(\'_mainId_' + field.fieldname +'\',\'_mainShow_' + field.fieldname +'\',\'_main_' + field.fieldname +'\',\'*0*\',\'0\')" style="color:#555555;font-size:16;" readonly="true" type="text" '+ 
	        					   'value="' + contName + '" id="_mainShow_' + field.fieldname +'" placeholder="请选择>" />'+
	        					   '<input type="hidden" id="_mainId_' + field.fieldname +'" value="' + contId + '"/>'+
	        					   '<input type="hidden" id="_main_' + field.fieldname +'" name="_main_' + field.fieldname +'" value="' + content + '"/></row>';
	        		pushMustFillArray(mustfilled,field.name,'_main_' + field.fieldname);
	        	//多选人 全部
	        	}else if(showType == '211' && readWrite == '1'){
	        		var contId='';
	        		var contName='';
	        		if(content && content.indexOf(";")>-1){
				    	var cons = content.split(";");
				    	contName=cons[0];
				    	contId=cons[1];
				    }
	        		custemCon += '<row onclick="selectUser(\'_mainId_' + field.fieldname +'\',\'_mainShow_' + field.fieldname +'\',\'_main_' + field.fieldname +'\',\'*0*\',\'1\')">'+
	        					   '<input onclick="selectUser(\'_mainId_' + field.fieldname +'\',\'_mainShow_' + field.fieldname +'\',\'_main_' + field.fieldname +'\',\'*0*\',\'1\')" style="color:#555555;font-size:16;" readonly="true" type="text" '+ 
	        					   'value="' + contName + '" id="_mainShow_' + field.fieldname +'" placeholder="请选择>" />'+
	        					   '<input type="hidden" id="_mainId_' + field.fieldname +'" value="' + contId + '"/>'+
	        					   '<input type="hidden" id="_main_' + field.fieldname +'" name="_main_' + field.fieldname +'" value="' + content + '"/></row>';
	        		pushMustFillArray(mustfilled,field.name,'_main_' + field.fieldname);
	        	//单选组织
	        	}else if(showType == '212' && readWrite == '1'){
	        		var contId='';
	        		var contName='';
	        		if(content && content.indexOf(";")>-1){
				    	var cons = content.split(";");
				    	contName=cons[0];
				    	contId=cons[1];
				    }
	        		custemCon += '<row onclick="selectUser(\'_mainId_' + field.fieldname +'\',\'_mainShow_' + field.fieldname +'\',\'_main_' + field.fieldname +'\',\'*0*\',\'2\')">'+
	        					   '<input onclick="selectUser(\'_mainId_' + field.fieldname +'\',\'_mainShow_' + field.fieldname +'\',\'_main_' + field.fieldname +'\',\'*0*\',\'2\')" style="color:#555555;font-size:16;" readonly="true" type="text" '+ 
	        					   'value="' + contName + '" id="_mainShow_' + field.fieldname +'" placeholder="请选择>" />'+
	        					   '<input type="hidden" id="_mainId_' + field.fieldname +'" value="' + contId + '"/>'+
	        					   '<input type="hidden" id="_main_' + field.fieldname +'" name="_main_' + field.fieldname +'" value="' + content + '"/></row>';
	        		pushMustFillArray(mustfilled,field.name,'_main_' + field.fieldname);
	        	//多选组织
	        	}else if(showType == '214' && readWrite == '1'){
	        		var contId='';
	        		var contName='';
	        		if(content && content.indexOf(";")>-1){
				    	var cons = content.split(";");
				    	contName=cons[0];
				    	contId=cons[1];
				    }
	        		custemCon += '<row onclick="selectUser(\'_mainId_' + field.fieldname +'\',\'_mainShow_' + field.fieldname +'\',\'_main_' + field.fieldname +'\',\'*0*\',\'3\')">'+
	        					   '<input onclick="selectUser(\'_mainId_' + field.fieldname +'\',\'_mainShow_' + field.fieldname +'\',\'_main_' + field.fieldname +'\',\'*0*\',\'3\')" style="color:#555555;font-size:16;" readonly="true" type="text" '+ 
	        					   'value="' + contName + '" id="_mainShow_' + field.fieldname +'" placeholder="请选择>" />'+
	        					   '<input type="hidden" id="_mainId_' + field.fieldname +'" value="' + contId + '"/>'+
	        					   '<input type="hidden" id="_main_' + field.fieldname +'" name="_main_' + field.fieldname +'" value="' + content + '"/></row>';
	        		pushMustFillArray(mustfilled,field.name,'_main_' + field.fieldname);
	        	//单选人 本组织
	        	}else if(showType == '704' && readWrite == '1'){
	        		var contId='';
	        		var contName='';
	        		if(content && content.indexOf(";")>-1){
				    	var cons = content.split(";");
				    	contName=cons[0];
				    	contId=cons[1];
				    }
	        		custemCon += '<row onclick="selectUser(\'_mainId_' + field.fieldname +'\',\'_mainShow_' + field.fieldname +'\',\'_main_' + field.fieldname +'\',\'*'+orgId+'*\',\'0\')">'+
	        					   '<input onclick="selectUser(\'_mainId_' + field.fieldname +'\',\'_mainShow_' + field.fieldname +'\',\'_main_' + field.fieldname +'\',\'*'+orgId+'*\',\'0\')" readonly="true" style="color:#555555;font-size:16;" type="text" '+ 
	        					   'value="' + contName + '" id="_mainShow_' + field.fieldname +'" placeholder="请选择>" />'+
	        					   '<input type="hidden" id="_mainId_' + field.fieldname +'" value="' + contId + '"/>'+
	        					   '<input type="hidden" id="_main_' + field.fieldname +'" name="_main_' + field.fieldname +'" value="' + content + '"/></row>';
	        		pushMustFillArray(mustfilled,field.name,'_main_' + field.fieldname);
	        	//多选人 本组织
	        	}else if(showType == '705' && readWrite == '1'){
	        		var contId='';
	        		var contName='';
	        		if(content && content.indexOf(";")>-1){
				    	var cons = content.split(";");
				    	contName=cons[0];
				    	contId=cons[1];
				    }
	        		custemCon += '<row onclick="selectUser(\'_mainId_' + field.fieldname +'\',\'_mainShow_' + field.fieldname +'\',\'_main_' + field.fieldname +'\',\'*'+orgId+'*\',\'1\')">'+
	        					   '<input onclick="selectUser(\'_mainId_' + field.fieldname +'\',\'_mainShow_' + field.fieldname +'\',\'_main_' + field.fieldname +'\',\'*'+orgId+'*\',\'1\')" readonly="true" style="color:#555555;font-size:16;" type="text" '+ 
	        					   'value="' + contName + '" id="_mainShow_' + field.fieldname+'" placeholder="请选择>" />'+
	        					   '<input type="hidden" id="_mainId_' + field.fieldname+'" value="' + contId + '"/>'+
	        					   '<input type="hidden" id="_main_' + field.fieldname+'" name="_main_' + field.fieldname+'" value="' + content + '"/></row>';
	        		pushMustFillArray(mustfilled,field.name,'_main_' + field.fieldname);
	        	//多选组织和人
	        	}else if(showType == '216' && readWrite == '1'){
	        		var contId='';
	        		var contName='';
	        		if(content && content.indexOf(";")>-1){
				    	var cons = content.split(";");
				    	contName=cons[0];
				    	contId=cons[1];
				    }
	        		custemCon += '<row onclick="selectUser(\'_mainId_' + field.fieldname +'\',\'_mainShow_' + field.fieldname +'\',\'_main_' + field.fieldname +'\',\'*0*\',\'4\')">'+
	        					   '<input onclick="selectUser(\'_mainId_' + field.fieldname +'\',\'_mainShow_' + field.fieldname +'\',\'_main_' + field.fieldname +'\',\'*0*\',\'4\')" readonly="true" style="color:#555555;font-size:16;" type="text" '+ 
	        					   'value="' + contName + '" id="_mainShow_' + field.fieldname+'" placeholder="请选择>" />'+
	        					   '<input type="hidden" id="_mainId_' + field.fieldname+'" value="' + contId + '"/>'+
	        					   '<input type="hidden" id="_main_' + field.fieldname+'" name="_main_' + field.fieldname+'" value="' + content + '"/></row>';
	        		pushMustFillArray(mustfilled,field.name,'_main_' + field.fieldname);
	        	}else if((showType=='705' || showType=='704' || showType=='214' || showType=='216'
				    || showType=='212' || showType=='211' || showType=='210') && readWrite != '1'){
	        		var contName='';
	        		if(content && content.indexOf(";")>-1){
				    	var cons = content.split(";");
				    	contName=cons[0];
				    }
				    custemCon += '<row><label style="color:#555555">'+contName+'</label></row>';
	        	}else{
	        		if(content && showType){
						custemCon += '<row><label style="color:#555555">'+content+'</label></row>';
					}
	        	}
				custemCon += '</col></item>';
				return custemCon;
			}	        
	        
	        // 选择用户
	        var userIdConIdVal;
	        var userNameConIdVal;
	        var userAllVal;
	        function selectUser(userIdConId,userNameConId,userAll,range,type){
	        	userIdConIdVal = userIdConId;
	        	userNameConIdVal = userNameConId;
	        	userAllVal = userAll;
		        storage.setItem('sys_selectuser_range',range);
		        storage.setItem('sys_selectuser_userids',$(userIdConIdVal).value);
		        storage.setItem('sys_selectuser_usernames',$(userNameConIdVal).value);
		        storage.setItem('sys_selectuser_returnfuc','setUserInfo');
		        if('0' == type){
				    $page.open('../public/selectSingleUser.xml', {animation:'down-to-up'});
		        }else if('1' == type){
				    $page.open('../public/selectUser.xml', {animation:'down-to-up'});
		        }else if('2' == type){
				    $page.open('../public/selectSingleOrg.xml', {animation:'down-to-up'});
		        }else if('3' == type){
				    $page.open('../public/selectOrg.xml', {animation:'down-to-up'});
		        }else if('4' == type){
				    $page.open('../public/selectUserOrg.xml', {animation:'down-to-up'});
		        }
			}
	        
	        // 设置选人值
	        function setUserInfo(id,name){
	         	var idVal = id;
	            if(idVal.indexOf("$$")==-1){   //单人，需要单独处理。
	            	idVal = idVal.replace(/(\$)/g,'')+',';
			    }
	        	$(userIdConIdVal).value = idVal;
	        	$(userNameConIdVal).value = name;
	        	$(userAllVal).value = name + ';' + idVal;
	        }
	        
	        // 批示意见内容,各环节办理节点意见
	        function createCommentCon(comment){
	        //	var isCurrent = comment.current;
	        	var commentType = '';
	        	var commentShouxieOaUrl = '';
	        	var commentShouxie = '';
	        	var commentCon = '<item style="padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;">';
	        	commentCon += '<row><label style="align:left;font-size:16;color:#555555">'+comment.step+':</label></row></col></item><item style="margin:0;padding:0;"><col>';
	        	if(comment instanceof Array){
        			for(var i=0,length=comment.length;i<length;i++){
        				commentType = comment[i].type;
        				if(commentType == '0'){
        					//普通意见
        					commentCon += '<row><label style="color:#555555;margin-left:10;">'+comment[i].content +'</label></row>';
        				}
        				if(commentType == '1'){
        					// pc手写
							commentShouxieOaUrl = webServiceUrl + 'upload/workflow_acc/rev' + comment[i].content + '.gif';
							commentShouxie = evoUrl+'/ezOffice/download/resizeHandSign.do?url='+commentShouxieOaUrl;
        					commentCon += '<row><img src="'+commentShouxie+'"/></row>';
        				}
			        	commentCon += '<row><label style="align:right;color:#555555">' + comment[i].person + ' (' + comment[i].date +')</label></row>';
        			}
        		}else if(comment instanceof Object){
        		    commentType = comment.type;
       				if(commentType == '0'){
       					//普通意见
       					commentCon += '<row><label style="color:#555555;margin-left:10;">'+comment.content +'</label></row>';
       				}
       				if(commentType == '1'){
       					// pc手写
						commentShouxieOaUrl = webServiceUrl + 'upload/workflow_acc/rev' + comment.content + '.gif';
						commentShouxie = evoUrl+'/ezOffice/download/resizeHandSign.do?url='+commentShouxieOaUrl;
       					commentCon += '<row><img src="'+commentShouxie+'"/></row>';
       				}
		        	commentCon += '<row><label style="align:right;color:#555555">' +comment.person + ' (' + comment.date +')</label></row>';
        		}
	        	commentCon += '</col></item>';
	        	return commentCon;
	        }
	        
        	 //创建流程图
	        function createFlowImg(flowGraphUrl,picRootPath){
	        //	if(!(flowGraphUrl instanceof Array)){
	           if(false){
	        	//	var imgPath = webServiceUrl + 'upload/workflow_acc/' + flowGraphUrl + '?rand=' + Math.random();
		        	picRootPath = evoUrl +'/ezOffice/download/resizeHandSign.do?url=' +webServiceUrl + 'upload/workflow_acc/';
	        		var imgPath = picRootPath+flowGraphUrl;
		        	$('flowgraphurl').value = imgPath;
		        	var image = $C('<img src="' + imgPath + '"  id="flowImg" progress="true" style="align:center;height:400;width:300"/>');
		        	$('content_flow_pic').add(image);
	        	}else{
	        		$('tabbar').remove($('imgItem'));
	        		$('contents').remove($('content_flow_pic'));
	        	}
	        }
	        
	         // 创建底部内容
	        function createFootContent(workInfo){
	       	 	var workStatus = storage.getItem('workflow_workStatus');
	       	 	var workcurstep = workInfo.workcurstep;
				var modibutton = workInfo.modibutton;
	       	 	// 已阅
		        if(workStatus == '102'){
		        	return false;
		        }
	        	var haveBackButton = workInfo.havebackbutton;
	        	var modiButton = workInfo.modibutton;
	        	var itemContent = '';
	        	storage.setItem('workflow_tableId',workInfo.worktable_id ? workInfo.worktable_id : '');
				storage.setItem('workflow_recordId',workInfo.workrecord_id ? workInfo.workrecord_id : '');
				storage.setItem('workflow_activityId',workInfo.initactivity ? workInfo.initactivity : '');
				storage.setItem('workflow_stepCount',workInfo.workstepcount ? workInfo.workstepcount : '');
				storage.setItem('workflow_isForkTask',workInfo.isForkTask ? workInfo.isForkTask : '');
				storage.setItem('workflow_forkStepCount',workInfo.forkStepCount ? workInfo.forkStepCount : '');
				storage.setItem('workflow_forkId',workInfo.forkId ? workInfo.forkId : '');
				storage.setItem('workflow_smsRight',workInfo.smsRight ? workInfo.smsRight : '');
				var empLivingPhoto = $param['empLivingPhoto'];
				switch(workStatus){
					// 待办
					case '0' : {
						if(haveBackButton != 'true'){
			        		if(modiButton.indexOf('Tran') > 0 || modiButton.indexOf('AddSign') > 0|| modiButton.indexOf('Selfsend') > 0){
								itemContent = 			
						        	'<item style="col-width: 80%,20%">'+
										'<col>'+
											'<row style="height:50;">'+
												'<button onclick="sendFlow(\'' + workInfo.smsRight + '\',\'' + workInfo.worktitle + '\',\'' + workInfo.worksubmittime + '\',\'' + empLivingPhoto + '\');" '+
												'style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:200;height:38;font-size:14">发送</button>'+
											'</row>'+
										'</col>'+
										'<col>'+
								            '<row style="height:50;">'+
												'<button onclick="openPopMenu(\'' + modiButton + '\')" style="align:center;background:workflow_footer_menu.png;width:20;height:20"/>'+
								            '</row>'+
										'</col>'+
									'</item>';
			        		}else{
			        			itemContent = 			
						        	'<item style="">'+
										'<col>'+
											'<row style="height:50;">'+
												'<button onclick="sendFlow(\'' + workInfo.smsRight + '\',\'' + workInfo.worktitle + '\',\'' + workInfo.worksubmittime + '\',\'' + empLivingPhoto + '\');" '+
												'style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:300;height:38;font-size:14">发送</button>'+
											'</row>'+
										'</col>'+
									'</item>';
			        		}
			        	}else{
			        		if(modiButton.indexOf('Tran') > 0 || modiButton.indexOf('AddSign') > 0|| modiButton.indexOf('Selfsend') > 0){
					        	itemContent = 			
						        	'<item style="col-width: 40%,40%,20%">'+
										'<col>'+
								            '<row style="height:50;">'+
								            	'<button onclick="backFlow();" style="align:center;background:null,#90D0FD;color:#90D0FD,white;border:1 #90D0FD;corner-radius:3;width:100;height:38;font-size:14">退回</button>'+
								            '</row>'+
										'</col>'+
										'<col>'+
											'<row style="height:50;">'+
												'<button onclick="sendFlow(\'' + workInfo.smsRight + '\',\'' + workInfo.worktitle + '\',\'' + workInfo.worksubmittime + '\',\'' + empLivingPhoto + '\');" style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:100;height:38;font-size:14">发送</button>'+
											'</row>'+
										'</col>'+
										'<col>'+
								            '<row style="height:50;">'+
												'<button onclick="openPopMenu(\'' + modiButton + '\')" style="align:center;background:workflow_footer_menu.png;width:20;height:20"/>'+
								            '</row>'+
										'</col>'+
									'</item>';
			        		}else{
					        	itemContent = 			
						        	'<item style="">'+
										'<col>'+
								            '<row style="height:50;">'+
								            	'<button onclick="backFlow();" style="align:center;background:null,#90D0FD;color:#90D0FD,white;border:1 #90D0FD;corner-radius:3;width:125;height:38;font-size:14">退回</button>'+
								            '</row>'+
										'</col>'+
										'<col>'+
											'<row style="height:50;">'+
												'<button onclick="sendFlow(\'' + workInfo.smsRight + '\',\'' + workInfo.worktitle + '\',\'' + workInfo.worksubmittime + '\',\'' + empLivingPhoto + '\');" style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:125;height:38;font-size:14">发送</button>'+
											'</row>'+
										'</col>'+
									'</item>';
			        		}
			        	}
			        	break;
					}
					// 待阅
					case '2' : {
						itemContent = 			
					        	'<item>'+
									'<col>'+
										'<row style="height:50;">'+
											'<button onclick="sendFlowed();" style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:300;height:38;font-size:14">发送</button>'+
										'</row>'+
									'</col>'+
								'</item>';
						break;
					}
					// 已办
					case '101' : {
						if(workcurstep.indexOf('办理完毕') < 0){
							if(modibutton.indexOf('Undo') > -1 && modibutton.indexOf('Wait') > -1){
								itemContent = 			
						        	'<item style="col-width: 50%,50%">'+
										'<col>'+
								            '<row style="height:50;">'+
								            	'<button onclick="workfolwUndo();" style="align:center;background:null,#90D0FD;color:#90D0FD,white;border:1 #90D0FD;corner-radius:3;width:125;height:38;font-size:14">撤办</button>'+
								            '</row>'+
										'</col>'+
										'<col>'+
											'<row style="height:50;">'+
												'<button onclick="sendFlowAgain();" style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:125;height:38;font-size:14">催办</button>'+
											'</row>'+
										'</col>'+
									'</item>';
							}else if(modibutton.indexOf('Undo') > -1 && modibutton.indexOf('Wait') < 0){
					        	itemContent = 			
						        	'<item>'+
										'<col>'+
											'<row style="height:50;">'+
												'<button onclick="workfolwUndo();" style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:300;height:38;font-size:14">撤办</button>'+
											'</row>'+
										'</col>'+
									'</item>';
							}else if(modibutton.indexOf('Undo') < 0 && modibutton.indexOf('Wait') > -1){
					        	itemContent = 			
						        	'<item>'+
										'<col>'+
											'<row style="height:50;">'+
												'<button onclick="sendFlowAgain();" style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:300;height:38;font-size:14">催办</button>'+
											'</row>'+
										'</col>'+
									'</item>';
							}
						}
						break;
					}
					// 我的文件
					case '1100' : {
						if(workInfo.workcurstep.indexOf('办理完毕') < 0){
							if(workInfo.workcurstep.indexOf('退回') < 0){
								itemContent = 			
					        	'<item>'+
									'<col>'+
										'<row style="height:50;">'+
											'<button onclick="sendFlowAgain();" style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:300;height:38;font-size:14">催办</button>'+
										'</row>'+
									'</col>'+
								'</item>';
							}
						}
						break;
					}
				}
	        	$('footer_list').addMore('<imag><list>' + itemContent + '</list></imag>');
	        }
	        
	         // 打开转办 加签
	        function openPopMenu(modiButton){
	        	if(modiButton.indexOf('Tran') < 0){
		        	$('popupmenu_list').remove($('tranInfoItem'));
	        	}
	        	if(modiButton.indexOf('AddSign') < 0){
		        	$('popupmenu_list').remove($('addSignItem'));
	        	}
	        	if(modiButton.indexOf('Selfsend') < 0){
		        	$('popupmenu_list').remove($('selfSendItem'));
	        	}
	       		$('main_popupmenu').open();
	        }
	        
	        //加载流程记录页面数据
	        var recordLoadFlag = '0';
	        function loadFlowRecord(){
	        	if(recordLoadFlag == '1'){
	        		return false;
	        	}
	        	recordLoadFlag = '1';
				$http.post(
        			evoUrl + '/ezOffice/dealfile/getFlowRecord.do',{workId : workId},
        			function(data){
        				if(!data){
        					alert('查询流程记录失败！');
        					return false;
        				}
        				var jsonData = eval('(' + data + ')');
        				if(jsonData.logonerror && jsonData.logonerror=='1'){
		         			alert("该账号已在设备"+jsonData.deviceId+"上登录");
		          			$page.open('../index.xml',{target:'_self'});
		                    return;
		                }
        				var data_0 = jsonData.data_0;
        				if(!data_0){
        					alert('查询流程记录失败！');
        					return false;
        				}
        				var result = data_0.message.result;
        				if(result != '1'){
        					alert('查询流程记录失败！');
        					return false;
        				}
        				var recordArray = data_0.data;
        				if(!recordArray){
        					alert('无流程记录！');
        					return false;
        				}
        				var listJson = {items:[]};
	        			var itemJson;
	        			var logReceive;
        				if(recordArray instanceof Array){
        					for(var i=0,length=recordArray.length;i<length;i++){
        						logReceive = recordArray[i].logReceive;
        						if(logReceive instanceof Array){
        							logReceive = '';
        						}else{
        							logReceive = logReceive.replace(',','');
        						}
        						itemJson = {
			                        template : 0,
			                        widgets : {
			                            logUserName : {text : recordArray[i].logUserName},
			                            logTime : {text : recordArray[i].logTime.substring(0,16)},
			                            logAction : {text : recordArray[i].logAction},
			                            logReceive : {text : logReceive}
			                        }
			                    }
			                    listJson.items.push(itemJson);
        					}
        				}else if(recordArray instanceof Object){
        					logReceive = recordArray.logReceive;
       						if(logReceive instanceof Array){
       							logReceive = '';
       						}else{
       							logReceive = logReceive.replace(',','');
       						}
							itemJson = {
		                        template : 0,
		                        widgets : {
		                            logUserName : {text : recordArray.logUserName},
		                            logTime : {text : recordArray.logTime.substring(0,16)},
		                            logAction : {text : recordArray.logAction},
		                            logReceive : {text : logReceive}
		                        }
		                    }
		                    listJson.items.push(itemJson);
        				}
        				$('content_flow_record_list').update(listJson);
        			},function(error) {
				    if (error == 'timeout') {
						hint('连接服务器超时！');
				    } else if (error == '404') {
						hint('链接超时重新登录！');
				    } else if (error == '500') {
						hint('内部服务器错误！');
				    } else {
						hint('访问网络错误！错误代码:' + error);
				    }
				    $page.open('../index.xml',{animation:'down-to-up'});
				  }
        		);
	        } 
	        
	        //必填项数组
	        var mustFillCon = new Array();
	        
	        //添加数组元素 
	        function pushMustFillArray(mustfilled,fieldName,conId){
	        	if(mustfilled == '0'){
	        		return false;
	        	}
	        	mustFillCon.push(fieldName + ';' + conId);
	        }
	        //必填checkbox
	        var mustFillCheckbox = new Array();
	        
	        //添加数组元素 
	        function pushMustFillCheckboxArray(mustfilled,fieldName,conId,len){
	        	if(mustfilled == '0'){
	        		return false;
	        	}
	        	mustFillCheckbox.push(fieldName + ';' + conId+ ';' +len);
	        }
	        //发送时验证表单
	        function checkForm(){
	        	var fieldInfoArray;
	        	var flag = true;
	        	for(var i=0,length=mustFillCon.length;i<length;i++){
	        		if(!mustFillCon[i]){
	        			return false;
	        		}
	        		fieldInfoArray = mustFillCon[i].split(';');
	        		if(!($(fieldInfoArray[1]).value)){
	        			alert(fieldInfoArray[0] + ' 不能为空！');
			        	return false;
	        		}
	        	}
	        	for(var i=0,length=mustFillCheckbox.length;i<length;i++){
	        		if(!mustFillCheckbox[i]){
	        			return false;
	        		}
	        		var chefieldInfoArray = mustFillCheckbox[i].split(';');
	        		var fname = chefieldInfoArray[0];
	        		var conId = chefieldInfoArray[1];
	        		var len = eval(chefieldInfoArray[2]);
	        		
	        		flag = false;
	        		for(var j=0;j<len;j++){
	        		    if(($(conId+j).checked)){
	        		        flag = true;
		        		}
	        		}
	        		if(!flag){
	        		   alert(fname + ' 不能为空！');
	        		   return false;
	        		}
	        	}
	        	if($('commentmustnonull')&& $('comment_input')){
				    var commentIsNone = $('commentmustnonull').value;  //节点中的批示意见是否为空表示，若为true为不能为空
				    if(commentIsNone == 'true'){
				    	 var comment_input_value = $('comment_input').value;
				    	 if(comment_input_value == null || comment_input_value == ''){
				    	 	alert('批示意见不能为空！');
				    	 	flag = false;
				    	 }
				    }
			    }
	        	return flag;
	        }
	        
	        // 发送流程 
			function sendFlow(smsRight,workTitle,workSubmitTime,empLivingPhoto){
			    if(!checkForm()){    //表单验证
					return false;
				}
				$('sendForm').action = evoUrl + '/ezOffice/doc/sendnew.do';
				$('sendForm').submit(function(data) {
					if(!data){
						alert('保存表单失败！');
						return false;
					}
					var dataJson = eval('('+data+')');
					if(dataJson.logonerror && dataJson.logonerror=='1'){
	         			alert("该账号已在设备"+dataJson.deviceId+"上登录");
	          			$page.open('../index.xml',{target:'_self'});
	                    return;
	                }
					var result = dataJson.result;
					if(result == 'success'){
						var isForkTask = $('isForkTask').value;
						var commentType = $('commentType').value;
						var $comment = $('comment_input');
						var commentCon = '';
						if(commentType == '4'){
							commentCon = $('comment_input_shouxie').value;
						}else if(commentType == '5'){
							commentCon = $('comment_input_yuyin').value;
						}else{
							if($comment){
								commentCon = $comment.value;
							}
						}
						// 手写审批、语言批示数据
						var commentShouxie_backName = dataJson.data_1;
						var commentYuyin_backName =  dataJson.data_2;
						$page.open(
						'../workflow/workflow_sendnew.xml?fromXml='+fromXml+'&model='+model+'&smsRight='+smsRight+'&workTitle='+encodeURIComponent(workTitle)+
						'&workSubmitTime='+encodeURIComponent(workSubmitTime)+'&empLivingPhoto='+empLivingPhoto+
						'&isForkTask='+isForkTask+'&commentType='+commentType+'&comment='+encodeURIComponent(commentCon)+
						'&commentShouxie_backName='+commentShouxie_backName+'&commentYuyin_backName='+commentYuyin_backName+'&isDossier='+isDossier+'&commentAttitudeType='+commentAttitudeType,
						{animation:'down-to-up'});
					}else{
						alert('保存表单失败！');					
					}
	            }, function(error) {
	                alert('提交失败！');
	            });
			}
				        
	        // 退回流程
	        function backFlow(){
					var urlParam = $('backForm').serialize()+'&empLivingPhoto=' + $param['empLivingPhoto'];
					$page.open('../workflow/workflow_back.xml?'+urlParam,{animation:'down-to-up'});
	        }
	        
	        // 待阅发送  
			function sendFlowed(){
				$('sendForm').action = evoUrl + '/ezOffice/workflow/readOver.do?workId='+workId;
				$('sendForm').submit(function(data) {
					if(!data){
						alert('保存表单失败！');
						return false;
					}
					var dataJson = eval('('+data+')');
					if(dataJson.logonerror && dataJson.logonerror=='1'){
	         			alert("该账号已在设备"+dataJson.deviceId+"上登录");
	          			$page.open('../index.xml',{target:'_self'});
	                    return;
	                }
					var result = dataJson.result;
					if(result == 'success'){
						alert('发送成功！');
						$page.close(-1);
					    $page.open('dealfile_index.xml?workStatus=2',{target:'_self'});		
					}else{
						alert('发送失败！');					
					}
	            }, function(error) {
	                alert('发送异常！');
	            });
			}
			 
	        // 打开催办页面发送  
			function sendFlowAgain(){
				$page.open('dealfile_pressInfo.xml?'+$('sendFormAgain').serialize(),{animation:'down-to-up'});
			}
			
			// 流程撤办
			function workfolwUndo(){
				$('sendForm').action = evoUrl + '/ezOffice/workflow/workfolwUndo.do?workId='+workId;
				$('sendForm').submit(function(data) {
					if(!data){
						alert('撤办失败！');
						return false;
					}
					var dataJson = eval('('+data+')');
					if(dataJson.logonerror && dataJson.logonerror=='1'){
	         			alert("该账号已在设备"+dataJson.deviceId+"上登录");
	          			$page.open('../index.xml',{target:'_self'});
	                    return;
	                }
					var result = dataJson.result;
					if(result == 'success'){
						alert('撤办成功！');
						$page.open('dealfile_index.xml',{animation:'down-to-up'});
					}else{
						alert('撤办失败！');					
					}
	            }, function(error) {
	                alert('撤办异常！');
	            });
			} 
			
			// 转办发送
			function tranInfo(){
				$('main_popupmenu').close();
				var commentType = $('commentType').value;
				commentType = '';
				var $comment = $('comment_input');
				var commentCon = '';
				if(commentType == '4'){
					commentCon = $('comment_input_shouxie').value;
				}else if(commentType == '5'){
					commentCon = $('comment_input_yuyin').value;
				}else{
					if($comment){
						commentCon = $comment.value;
					}
				}
				$page.open('../workflow/workflow_tranInfo.xml?fromXml='+fromXml+'&workId='+workId+'&workcurstep='+encodeURIComponent($('workcurstep').value)+'&commentType='+commentType+'&comment='+encodeURIComponent(commentCon),
				{animation:'down-to-up'});
			}
			
			// 加签发送
			function addSign(){
				$('main_popupmenu').close();
				$page.open('../workflow/workflow_addSign.xml?workId='+workId+'&workcurstep='+encodeURIComponent($('workcurstep').value),
				{animation:'down-to-up'});
			}     
			
			// 阅件发送
			function selfsend(){
				$('main_popupmenu').close();
				$page.open('../workflow/workflow_selfsend.xml?fromXml='+fromXml+'&workId='+workId+'&workcurstep='+encodeURIComponent($('workcurstep').value),
				{animation:'down-to-up'});
			}  
        ]]>
    </script>
	<page>
        <title style="background:#3daffe;tint-color:white">
            <left>
            	<button role="back"></button>
            </left>
            <center>
            	<label>文件送审签</label>
            </center>
        </title>
        <header id="headers" style="display:none">
        	<tabbar id="tabbar" style="label-color:#b8b8b8,#008eef;indicator-color:#008eef;background:#f9f9f9;">
                <item label="流程表单"></item>
                <item id="imgItem" label="流程图"></item>
                <item label="流程记录" onclick="loadFlowRecord();"></item>
            </tabbar>
        </header>
        <popupmenu id="main_popupmenu" position="bottomright" style="width:100;offset-x:5;offset-y:-2">
			<list id="popupmenu_list">
				<item id="tranInfoItem" onclick="tranInfo();"  style="background:#3daffe,#474747">
	         		<label style="align:center;color:#F0F9FF,white">转办</label>
	         	</item>            
	         	<item id="addSignItem" onclick="addSign();"  style="background:#3daffe,#474747">
	         		<label style="align:center;color:#F0F9FF,white">加签</label>
	         	</item>
	         	<item id="selfSendItem" onclick="selfsend();"  style="background:#3daffe,#474747;">
	         		<label style="align:center;color:#F0F9FF,white">阅件</label>
	         	</item>
		    </list>
		</popupmenu>
		<contents id="contents">
            <content style="background:white" id="content_form">
				<form id="sendForm" multipart="true" prompt="请稍后...">
					<input type="hidden" id="__sys_operateType" name="__sys_operateType" value="2"/>
					<input type="hidden" id="__sys_infoId" name="__sys_infoId" value=""/>
					<input type="hidden" id="__sys_pageId" name="__sys_pageId" value=""/>
					<input type="hidden" id="__sys_formType" name="__sys_formType" value=""/>
					<input type="hidden" id="__main_tableName" name="__main_tableName" value=""/>
					<input type="hidden" id="tableId" name="tableId" value=""/>
					<input type="hidden" id="recordId" name="recordId" value=""/>
					<input type="hidden" id="activityId" name="activityId" value=""/>
					<input type="hidden" id="workId" name="workId" value=""/>
					<input type="hidden" id="stepCount" name="stepCount" value=""/>
					<input type="hidden" id="actiCommFieldType" name="actiCommFieldType" value=""/>
					<input type="hidden" id="trantype" name="trantype" value=""/>
					<input type="hidden" id="isForkTask" name="isForkTask" value=""/>
					<input type="hidden" id="forkStepCount" name="forkStepCount" value=""/>
					<input type="hidden" id="forkId" name="forkId" value=""/>
					<input type="hidden" id="activityclass" name="activityclass" value=""/>
					<input type="hidden" id="commentField" name="commentField" value=""/>
					<input type="hidden" id="commentmustnonull" name="commentmustnonull" value=""/>
					<input type="hidden" id="backnocomment" name="backnocomment" value=""/>
					<input type="hidden" id="backMailRange" name="backMailRange" value=""/>
					<input type="hidden" id="smsRight" name="smsRight" value=""/>
					<input type="hidden" id="commentType" name="commentType" value="0"/>
					<input type="hidden" id="comment_input_shouxie" name="comment_input_shouxie" value=""/>
					<input type="hidden" id="comment_input_yuyin" name="comment_input_yuyin" value=""/>
					<input type="hidden" id="worktitle" name="worktitle" value=""/>
					<input type="hidden" id="workcurstep" name="workcurstep" value=""/>
					<input type="hidden" id="worksubmittime" name="worksubmittime" value=""/>
					<input type="hidden" id="workStatus" name="workStatus" value="0"/>
					<input type="hidden" id="savetable" name="savetable" value="3"/>
					<list id="content_form_list">
					</list>
				</form>
				<form id="backForm" prompt="请稍后...">
					<input type="hidden" name="workId" id="back_workId" value=""/>
					<input type="hidden" name="empLivingPhoto" id="back_empLivingPhoto" value=""/>
					<input type="hidden" name="worktitle" id="back_worktitle" value=""/>
					<input type="hidden" name="workcurstep" id="back_workcurstep" value=""/>
					<input type="hidden" name="worksubmittime" id="back_worksubmittime" value=""/>
					<input type="hidden" name="workStatus" id="back_workStatus" value="0"/>
					<input type="hidden" name="tableId" id="back_tableId" value=""/>
					<input type="hidden" name="recordId" id="back_recordId" value=""/>
					<input type="hidden" name="stepCount" id="back_stepCount" value=""/>
					<input type="hidden" name="forkId" id="back_forkId" value=""/>
					<input type="hidden" name="forkStepCount" id="back_forkStepCount" value=""/>
					<input type="hidden" name="isForkTask" id="back_isForkTask" value=""/>
					<input type="hidden" name="curCommField" id="back_curCommField" value="" />
					<input type="hidden" name="backWorkProcessId" id="back_backWorkProcessId" value="" />
					<input type="hidden" name="workType" id="back_workType" value="" />
					<input type="hidden" name="workMainLinkFile" id="back_workMainLinkFile" value="" />
					<input type="hidden" name="workSubmitPerson" id="back_workSubmitPerson" value="" />
					<input type="hidden" name="workactivity" id="back_workActivity" value="" />
					<input type="hidden" name="standForUserid" id="back_standForUserid" value="" />
					<input type="hidden" name="isStandForWork" id="back_isStandForWork" value="" />
					<input type="hidden" id="savetable" name="savetable" value="3"/>
				</form>
				<form id="sendFormAgain" prompt="请稍后...">
					<input type="hidden" name="workId" id="again_workId" value=""/>
					<input type="hidden" name="empLivingPhoto" id="again_empLivingPhoto" value=""/>
					<input type="hidden" name="worktitle" id="again_worktitle" value=""/>
					<input type="hidden" name="workcurstep" id="again_workcurstep" value=""/>
					<input type="hidden" name="worksubmittime" id="again_worksubmittime" value=""/>
					<input type="hidden" name="workStatus" id="again_workStatus" value="1100"/>
					<input type="hidden" id="savetable" name="savetable" value="3"/>
				</form>
            </content>
            <content style="background:white" id="content_flow_pic">
            	<input type="hidden" name="flowGraphUrl" id="flowgraphurl" value="" />
            	<button onclick="fullScreenBrowse();" id="bottonselect" target="_blank">全屏查看</button>
            </content>
            <content style="background:white" id="content_flow_record">
            	<list id="content_flow_record_list" reuse="true">
        			<item style="col-width:3%,32%,2%,26%,2%,32%,*;" >
        			    <col>
            			</col>
            			<col>
            				<row>
            					<label reusekey="logUserName" style="color:#555555;align:left"></label>
            				</row>
            				<row><label reusekey="logTime" style="align:left;font-size:8;color:#B8b8b8"></label></row>
            			</col>
            			<col>
            			</col>
            			<col>
            				<row>
            					<label reusekey="logAction" style="align:left;font-size:10;color:#38adff"></label>
            				</row>
            			</col>
            			<col>
            			</col>
            			<col>
            				<row>
            					<label reusekey="logReceive" style="align:left;color:#555555;padding-right:2"></label>
            				</row>
            			</col>
            			<col>
            			</col>
            		</item>
            	</list>
            </content>
        </contents>
		<footer id="footer" style="background:#F9F9F9">
			<list type="toolbar" id="footer_list">
			</list>
        </footer>
	</page>
</imag>