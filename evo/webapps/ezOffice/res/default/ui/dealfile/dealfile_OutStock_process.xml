<?xml version="1.0" encoding="utf-8"?>
<imag>
	<script>
        <![CDATA[
            var fromXml = $param['fromXml'];
            var model = $param['model'];
            var info = $phone.info();
            var fujianwidth='';
            if(info['platform']=='android'){
              fujianwidth='width:200';
            }
        	var storage = $phone.localStorage();
        	var evoUrl = storage.getItem('evoUrl');
        	var	workStatus = storage.getItem('workflow_workStatus');
	        var workId = storage.getItem('workflow_workId');
	        var webServiceUrl = storage.getItem('webServiceUrl');
	        var itemContent = '';
	        // 页面加载完后执行
        	$page.onload = function(){
        	//获取物品(领用出库/领用退库)流程办理信息
				$http.progress('正在加载，请稍后...').post(
        			evoUrl + '/ezOffice/dealfile/outStockInfo.do',{workId : workId},
        			function(data){
        				if(!data){
        					alert('数据获取失败！');
        				}
        				data = data.replace(/\&/g,'＆');
        				var jsonData = eval('(' + data + ')');
        				if(jsonData.logonerror &&jsonData.logonerror=='1'){
			         		alert("该账号已在设备"+jsonData.deviceId+"上登录");
		          			$page.open('../index.xml',{target:'_self'});
		                    return;
		                }
        				var workInfoResult = jsonData.data_0.message.result;
        				var detailResult = jsonData.data_1.message.result;
        				if(workInfoResult != '1' || detailResult != '1'){
        					alert('数据获取失败！');
        				}
        				var workInfo = jsonData.data_0.data.workInfo;
        				var detailData = jsonData.data_1.data;
						var fildList = jsonData.data_1.data.fieldList;
						var commentList = jsonData.data_0.data.commentList;
						var $contentFormList = $('content_form_list');
						//创建流程图
						createFlowImg(workInfo.flowgraphurl,jsonData.data_2.picRootPath);
						$('headers').css('display','');
       					// 创建工作流程信息隐藏域
						createWorkInfoHiddenArea(workInfo);
       					// 初始化信息表单数据
       					if(fildList instanceof Array){
        					for(var i=0;i<fildList.length;i++){
        						createFormData(fildList[i]);
        					}
        				}else if(fildList instanceof Object){
       						createFormData(fildList);
        				}
       					//如果存在已批的意见则创建
       					if(commentList){
       						createCommList(commentList);
       					}
       					//如果存在办理意见则创建办理意见
       					if(workStatus=='0' || workStatus=='2'){
       						var officeList = jsonData.data_0.data.officelist;
       					    createCommentCon(workInfo,officeList);
       					}
       					$contentFormList.addMore('<imag><list>' + itemContent + '</list></imag>');
       					// 创建子表节点
       					createSubTableCon($contentFormList,workInfo,detailData);
       					// 创建底部内容
       					createFootContent(workInfo);
        			},function(error) {
				    if (error == 'timeout') {
						hint('连接服务器超时！');
				    } else if (error == '404') {
						hint('链接超时重新登录！');
				    } else if (error == '500') {
						hint('内部服务器错误！');
				    } else {
						hint('访问网络错误！错误代码:' + error);
				    }
				    $page.open('../index.xml',{animation:'down-to-up'});
				  }
        		);
        	}
        	
        	//创建工作流程信息隐藏域
			function createWorkInfoHiddenArea(workInfo){
				// 发送表单提交数据
				$('tableId').value = workInfo.worktable_id;
				$('recordId').value = workInfo.workrecord_id;
				$('activityId').value = workInfo.initactivity;
				$('workId').value = workInfo.wf_work_id;
				$('stepCount').value = workInfo.workstepcount;
				$('actiCommFieldType').value = workInfo.actiCommFieldType;
				$('trantype').value = workInfo.trantype;
				$('isForkTask').value = workInfo.isForkTask;
				$('forkStepCount').value = workInfo.forkStepCount;
				$('forkId').value = workInfo.forkId;
				$('commentField').value = workInfo.commentField;
				$('commentmustnonull').value = workInfo.commentmustnonull;
				$('backnocomment').value = workInfo.backnocomment;
				$('backMailRange').value = workInfo.backMailRange;
				$('smsRight').value = workInfo.smsRight;
				$('worktitle').value = workInfo.worktitle;
				$('workcurstep').value = workInfo.workcurstep;
				$('worksubmittime').value = workInfo.worksubmittime;
				// 退回表单提交数据
				$('back_workId').value = workInfo.wf_work_id;
				$('back_worktitle').value = workInfo.worktitle;
				$('back_workcurstep').value = workInfo.workcurstep;
				$('back_worksubmittime').value = workInfo.worksubmittime;
				$('back_tableId').value = workInfo.worktable_id;
				$('back_recordId').value = workInfo.workrecord_id;
				$('back_stepCount').value = workInfo.workstepcount;
				$('back_forkId').value = workInfo.forkId;
				$('back_forkStepCount').value = workInfo.forkStepCount;
				$('back_isForkTask').value = workInfo.isForkTask;
				$('back_curCommField').value = workInfo.commentField;
				$('back_backWorkProcessId').value = workInfo.workprocess_id;
				$('back_workType').value = workInfo.worktype;
				$('back_workMainLinkFile').value = workInfo.workmainlinkfile;
				$('back_workSubmitPerson').value = workInfo.worksubmitperson;
				$('back_workActivity').value = workInfo.workactivity;
				$('back_standForUserid').value = workInfo.standforuserid;
				$('back_isStandForWork').value = workInfo.isstandforwork;
				
				// 催办/撤办发送表单提交数据
				$('again_workId').value = workInfo.wf_work_id;
				$('again_empLivingPhoto').value = $param['empLivingPhoto'];
				$('again_worktitle').value = workInfo.worktitle;
				$('again_workcurstep').value = workInfo.workcurstep;
				$('again_worksubmittime').value = workInfo.worksubmittime;
			}
			
       	//初始化信息表单数据
        function createFormData(fild){
        
        	//2:出库 
        	if(fild.ssMode == "2"){
        		//出库单号
				if(fild.serial !='' && fild.serial !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">出库单号:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.serial+'</label>'+
							'</col></item>';
				}
				//出库仓库名称
				if(fild.stockName !='' && fild.stockName !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">出库仓库:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.stockName+'</label>'+
							'</col></item>';
				}
				//出库部门名称
				if(fild.orgName !='' && fild.orgName !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">出库部门:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.orgName+'</label>'+
							'</col></item>';
				}
				//领用人名称
				if(fild.ssUseMan !='' && fild.ssUseMan !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">领用人:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.ssUseMan+'</label>'+
							'</col></item>';
				}
				//出库日期
				if(fild.ssDate !='' && fild.ssDate !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">出库日期:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.ssDate+'</label>'+
							'</col></item>';
				}
				//出库类别名称
				if(fild.ssTypeName !='' && fild.ssTypeName !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">出库类别:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.ssTypeName+'</label>'+
							'</col></item>';
				}
				//领料部门名称
				if(fild.lyDeptName !='' && fild.lyDeptName !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">领料部门:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.lyDeptName+'</label>'+
							'</col></item>';
				}
				//用途
				if(fild.uses !='' && fild.uses !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">用途:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.uses+'</label>'+
							'</col></item>';
				}
				//备注
				if(fild.remark !='' && fild.remark !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">备注:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.remark+'</label>'+
							'</col></item>';
				}
				//3:退库
        	}else if(fild.ssMode == "3"){
        		//退库单号
				if(fild.serial !='' && fild.serial !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">退库单号:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.serial+'</label>'+
							'</col></item>';
				}
				//退库仓库名称
				if(fild.stockName !='' && fild.stockName !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">退库仓库:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.stockName+'</label>'+
							'</col></item>';
				}
				//退库部门名称
				if(fild.orgName !='' && fild.orgName !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">退库部门:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.orgName+'</label>'+
							'</col></item>';
				}
				//退库人名称
				if(fild.ssUseMan !='' && fild.ssUseMan !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">退库人:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.ssUseMan+'</label>'+
							'</col></item>';
				}
				//退库日期
				if(fild.ssDate !='' && fild.ssDate !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">退库日期:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.ssDate+'</label>'+
							'</col></item>';
				}
				//退库类别名称
				if(fild.ssTypeName !='' && fild.ssTypeName !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">退库类别:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.ssTypeName+'</label>'+
							'</col></item>';
				}
				//领料部门名称
				if(fild.lyDeptName !='' && fild.lyDeptName !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">领料部门:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.lyDeptName+'</label>'+
							'</col></item>';
				}
				//用途
				if(fild.uses !='' && fild.uses !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">用途:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.uses+'</label>'+
							'</col></item>';
				}
				//备注
				if(fild.remark !='' && fild.remark !=null){
					itemContent +='<item style="col-width:100,*;padding:0;margin:0;">'+
							'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
							'<label style="align:left;font-size:16;color:#555555">备注:</label>'+
							'</row></col><col style="padding:10;margin:10;">'+
							'<label>'+fild.remark+'</label>'+
							'</col></item>';
				}
        	}
        }
        
        //-------------------------------子表相关----------------------------------
        // 创建子表数据
		function createSubTableCon(contentFormList,workInfo,detailData){
			var itemContent = '';
			var subTableList = detailData.subTableList;
			//2:出库 or 3:退库
			var ssMode = detailData.fieldList.ssMode;
			if(!subTableList){
				return false;
			}
			var subFieldList;
			var fieldCount = 0;
			if(subTableList instanceof Array){
					subFieldList = subTableList;
					fieldCount = subTableList.length;
					itemContent = '<item id="sub" style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;padding:10;margin:10;"><row><label style="align:left;font-size:16;color:#555555">子表(物品信息)填写:</label></row></col><col style="padding:10;margin:10;"><row>'+
									   '<input readonly="true" style="border:0 white;font-size:16;color:#555555" type="text" placeholder="" value="'+fieldCount+'条子表数据>"/></row></col></item>';
					contentFormList.addMore('<imag><list>' + itemContent + '</list></imag>');
					$('sub').onclick = "openSubTableCon('" + JSON.stringify(subFieldList) + "','" + ssMode + "')";
			}else if(subTableList instanceof Object){
					subFieldList = subTableList.subFieldList;		
					if(!subFieldList){
						subFieldList = subTableList;
					}else{
						if(subFieldList instanceof Array){
							fieldCount = subFieldList.length;
							itemContent = '<item id="sub" onclick="openSubTableCon('+subFieldList+','+ssMode+');" style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;padding:10;margin:10;"><row><label style="align:left;font-size:16;color:#555555">子表(物品信息)填写:</label></row></col><col style="padding:10;margin:10;"><row>'+
									   '<input readonly="true" style="border:0 white;font-size:16;color:#555555" type="text" value="'+fieldCount+'条子表数据>"/></row></col></item>';
			                contentFormList.addMore('<imag><list>' + itemContent + '</list></imag>');
							$('sub').onclick = "openSubTableCon('" + JSON.stringify(subFieldList) + "','" + ssMode + "')";
						}else if(subFieldList instanceof Object){
						     if(subFieldList.goodsId == null || subFieldList.goodsId == ''|| subFieldList.goodsId == '[]' ){  //没有子表
							    	  fieldCount = 0;
							 }else{
							        fieldCount = 1;
							 		itemContent = '<item id="sub" onclick="openSubTableCon('+subFieldList+','+ssMode+');" style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;padding:10;margin:10;"><row><label style="align:left;font-size:16;color:#555555">子表(物品信息)填写:</label></row></col><col style="padding:10;margin:10;"><row>'+
									   '<input readonly="true" style="border:0 white;font-size:16;color:#555555" type="text" value="'+fieldCount+'条子表数据>"/></row></col></item>';
					                contentFormList.addMore('<imag><list>' + itemContent + '</list></imag>');
									$('sub').onclick = "openSubTableCon('" + JSON.stringify(subFieldList) + "','" + ssMode + "')";
							 }
						}else{
						    fieldCount = 0;
						}
					}
			}
		}
		// 打开子表
		var subTabelItemContent = '';
		function openSubTableCon(subFieldList,ptMode){
			$('content_form').scrollToTop();  //显示到顶部
			$('subTabel_form_list').clear();
			subTabelItemContent = '';
			var subFieldList = JSON.parse(subFieldList);
			if(subFieldList instanceof Array){
				for(var i=0,length=subFieldList.length;i<length;i++){
			        subTabelItemContent += '<item ><col><row><label style="align:left;font-size:14;">表'+eval(i+1)+'</label></row></col></item>';
					createSubTableField(subFieldList[i],ptMode);
					subTabelItemContent += '<item></item>';
				}
			}else if(subFieldList instanceof Object){
			    subTabelItemContent += '<item ><col><row><label style="align:left;font-size:14;">表1</label></row></col></item>';
				createSubTableField(subFieldList,ptMode);
				subTabelItemContent += '<item></item>';
			}
			//$page.open('dealfile_subProcess.xml?workId=' + workId);
			$('subTabel_form_list').addMore('<imag><list>' + subTabelItemContent + '</list></imag>');
			$('subTabel_form_list').css('display','');
			$('content_form_list').css('display','none');
			$('subTable_footer_list').css('display','');
			$('footer_list').css('display','none');
			createSubTableFoot();
		}
		// 创建子表字段数据
		function createSubTableField(fields,ssMode){
			//var fields = JSON.parse(fields);
			if(fields instanceof Array){
				for(var i=0,length=fields.length;i<length;i++){
					getFieldCon(fields[i],ssMode);
				}
			}else if(fields instanceof Object){
					getFieldCon(fields,ssMode);
			}
		}
		// 具体子表字段展示函数
		function getFieldCon(field,ssMode){
			if(ssMode == "2"){
				//存货编号
				if(field.goodsId !='' && field.goodsId !=null){
	        		subTabelItemContent += '<item style="col-width:100,*;padding:0;margin:0;">'+
								'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
								'<label style="align:left;font-size:16;color:#555555">存货编号:</label>'+
								'</row></col><col style="padding:10;margin:10;">'+
								'<label>'+field.goodsId+'</label>'+
								'</col></item>';
				}
				//存货名称
				if(field.goodsName !='' && field.goodsName !=null){
	        		subTabelItemContent += '<item style="col-width:100,*;padding:0;margin:0;">'+
								'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
								'<label style="align:left;font-size:16;color:#555555">存货名称:</label>'+
								'</row></col><col style="padding:10;margin:10;">'+
								'<label>'+field.goodsName+'</label>'+
								'</col></item>';
				}
				//规格型号
				if(field.goodsSpecs !='' && field.goodsSpecs !=null){
	        		subTabelItemContent += '<item style="col-width:100,*;padding:0;margin:0;">'+
								'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
								'<label style="align:left;font-size:16;color:#555555">规格型号:</label>'+
								'</row></col><col style="padding:10;margin:10;">'+
								'<label>'+field.goodsSpecs+'</label>'+
								'</col></item>';
				}
				//计量单位
				if(field.goodsUnit !='' && field.goodsUnit !=null){
	        		subTabelItemContent += '<item style="col-width:100,*;padding:0;margin:0;">'+
								'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
								'<label style="align:left;font-size:16;color:#555555">计量单位:</label>'+
								'</row></col><col style="padding:10;margin:10;">'+
								'<label>'+field.goodsUnit+'</label>'+
								'</col></item>';
				}
				//数量
				if(field.amount !='' && field.amount !=null){
	        		subTabelItemContent += '<item style="col-width:100,*;padding:0;margin:0;">'+
								'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
								'<label style="align:left;font-size:16;color:#555555">数量:</label>'+
								'</row></col><col style="padding:10;margin:10;">'+
								'<label>'+field.amount+'</label>'+
								'</col></item>';
				}
				//单价
				if(field.price !='' && field.price !=null){
	        		subTabelItemContent += '<item style="col-width:100,*;padding:0;margin:0;">'+
								'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
								'<label style="align:left;font-size:16;color:#555555">单价:</label>'+
								'</row></col><col style="padding:10;margin:10;">'+
								'<label>'+field.price+'</label>'+
								'</col></item>';
				}
				//金额
				if(field.money !='' && field.money !=null){
	        		subTabelItemContent += '<item style="col-width:100,*;padding:0;margin:0;">'+
								'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
								'<label style="align:left;font-size:16;color:#555555">金额:</label>'+
								'</row></col><col style="padding:10;margin:10;">'+
								'<label>'+field.money+'</label>'+
								'</col></item>';
				}
				//使用人
				if(field.userMan !='' && field.userMan !=null){
	        		subTabelItemContent += '<item style="col-width:100,*;padding:0;margin:0;">'+
								'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
								'<label style="align:left;font-size:16;color:#555555">使用人:</label>'+
								'</row></col><col style="padding:10;margin:10;">'+
								'<label>'+field.userMan+'</label>'+
								'</col></item>';
				}
			}else if(ssMode == "3"){
				//退货编号
				if(field.goodsId !='' && field.goodsId !=null){
	        		subTabelItemContent += '<item style="col-width:100,*;padding:0;margin:0;">'+
								'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
								'<label style="align:left;font-size:16;color:#555555">退货编号:</label>'+
								'</row></col><col style="padding:10;margin:10;">'+
								'<label>'+field.goodsId+'</label>'+
								'</col></item>';
				}
				//退货名称
				if(field.goodsName !='' && field.goodsName !=null){
	        		subTabelItemContent += '<item style="col-width:100,*;padding:0;margin:0;">'+
								'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
								'<label style="align:left;font-size:16;color:#555555">退货名称:</label>'+
								'</row></col><col style="padding:10;margin:10;">'+
								'<label>'+field.goodsName+'</label>'+
								'</col></item>';
				}
				//规格型号
				if(field.goodsSpecs !='' && field.goodsSpecs !=null){
	        		subTabelItemContent += '<item style="col-width:100,*;padding:0;margin:0;">'+
								'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
								'<label style="align:left;font-size:16;color:#555555">规格型号:</label>'+
								'</row></col><col style="padding:10;margin:10;">'+
								'<label>'+field.goodsSpecs+'</label>'+
								'</col></item>';
				}
				//计量单位
				if(field.goodsUnit !='' && field.goodsUnit !=null){
	        		subTabelItemContent += '<item style="col-width:100,*;padding:0;margin:0;">'+
								'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
								'<label style="align:left;font-size:16;color:#555555">计量单位:</label>'+
								'</row></col><col style="padding:10;margin:10;">'+
								'<label>'+field.goodsUnit+'</label>'+
								'</col></item>';
				}
				//数量
				if(field.amount !='' && field.amount !=null){
	        		subTabelItemContent += '<item style="col-width:100,*;padding:0;margin:0;">'+
								'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
								'<label style="align:left;font-size:16;color:#555555">数量:</label>'+
								'</row></col><col style="padding:10;margin:10;">'+
								'<label>'+field.amount+'</label>'+
								'</col></item>';
				}
				//单价
				if(field.price !='' && field.price !=null){
	        		subTabelItemContent += '<item style="col-width:100,*;padding:0;margin:0;">'+
								'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
								'<label style="align:left;font-size:16;color:#555555">单价:</label>'+
								'</row></col><col style="padding:10;margin:10;">'+
								'<label>'+field.price+'</label>'+
								'</col></item>';
				}
				//金额
				if(field.money !='' && field.money !=null){
	        		subTabelItemContent += '<item style="col-width:100,*;padding:0;margin:0;">'+
								'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
								'<label style="align:left;font-size:16;color:#555555">金额:</label>'+
								'</row></col><col style="padding:10;margin:10;">'+
								'<label>'+field.money+'</label>'+
								'</col></item>';
				}
				//退库人
				if(field.userMan !='' && field.userMan !=null){
	        		subTabelItemContent += '<item style="col-width:100,*;padding:0;margin:0;">'+
								'<col style="background:#f9f9f9;margin:10;padding:10;"><row>'+
								'<label style="align:left;font-size:16;color:#555555">退库人:</label>'+
								'</row></col><col style="padding:10;margin:10;">'+
								'<label>'+field.userMan+'</label>'+
								'</col></item>';
				}
			}
		}
		// 创建打开子表时的底部按钮
		function createSubTableFoot(){
			$('subTable_footer_list').clear();
			var footContent = 			
		        	'<item>'+
						'<col>'+
							'<row style="height:50;">'+
								'<button onclick="goBack();" '+
								'style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:400;height:38;font-size:14">返回</button>'+
							'</row>'+
						'</col>'+
					'</item>';
			$('subTable_footer_list').addMore('<imag><list>' + footContent + '</list></imag>');
		}
		
		// 返回主表界面
		function goBack(){
			$('subTabel_form_list').css('display','none');
			$('content_form_list').css('display','');
			$('subTable_footer_list').css('display','none');
			$('footer_list').css('display','');
		}
        //-------------------------------子表相关----------------------------------
        
        
			function createCommList(commentList){
				var commentShouxie = '';
				var commentYuyin = '';
				if(commentList instanceof Array){
					for(var i=0,length=commentList.length;i<length;i++){
						step = commentList[i].step+":";
						itemContent +='<item style="padding:0;margin:0;"><col style="background:#f9f9f9;padding:10;margin:10;"><row><label style="font-size:16;color:#555555;">'+step+'</label>'+
	        				   '</row></col></item><item style="padding:0;margin:0;"><col>';
						commentType = commentList[i].type;
						if(commentType == '4'){
							// 手写
							commentShouxieOaUrl = webServiceUrl + 'upload/workflow_acc/' + commentList[i].content.substring(0,6) + '/' + commentList[i].content;
							commentShouxie = evoUrl+'/ezOffice/download/resizeHandSign.do?url='+commentShouxieOaUrl;
							itemContent += '<row style="margin-bottom:20" onclick="view_sxContent(\'' + commentShouxie + '\');"><img src="'+commentShouxie+'"/></row>';
						}else if(commentType == '5'){
							// 语音
							commentYuyin = webServiceUrl + 'upload/workflow_acc/' + commentList[i].content.substring(0,6) + '/' + commentList[i].content;
							itemContent += '<row style="margin-bottom:20"><label onclick="playSound(\'' + commentYuyin + '\',\''+commentList[i].content+'\')" style="align:left;font-size:14;color:#38adff;">'+(commentList[i].content ? commentList[i].content : "")+'</label></row>';
						}else{
							itemContent += '<row style="margin-bottom:20"><label style="font-size:16;color:#555555;margin-left:10;">'+(commentList[i].content ? commentList[i].content : "")+'</label></row>';
						}
						itemContent += '<row><label style="align:right;color:#b8b8b8;font-size:12">'+commentList[i].person+'('+commentList[i].date+')</label></row></col></item>';
					}
				}else if(commentList instanceof Object){
					step = commentList.comment.step+":";
						itemContent +='<item style="padding:0;margin:0;"><col style="background:#f9f9f9;padding:10;margin:10;"><row><label style="font-size:16;color:#555555;">'+step+'</label>'+
	        				   '</row></col></item><item style="padding:0;margin:0;"><col>';
					commentType = commentList.comment.type;
					if(commentType == '4'){
						// 手写
						commentShouxieOaUrl = webServiceUrl + 'upload/workflow_acc/' + commentList.comment.content.substring(0,6) + '/' + commentList.comment.content;
						commentShouxie = evoUrl+'/ezOffice/download/resizeHandSign.do?url='+commentShouxieOaUrl;
					    itemContent += '<row style="margin-bottom:20" onclick="view_sxContent(\'' + commentShouxie + '\');"><img src="'+commentShouxie+'"/></row>';
					}else if(commentType == '5'){
						// 语音
						commentYuyin = webServiceUrl + 'upload/workflow_acc/' + commentList.comment.content.substring(0,6) + '/' + commentList.comment.content;
						itemContent += '<row style="margin-bottom:20"><label onclick="playSound(\'' + commentYuyin + '\',\''+commentList.comment.content+'\')" style="align:left;font-size:14;color:#38adff">'+(commentList.comment.content ? commentList.comment.content : "")+'</label></row>';
					}else{
						itemContent += '<row style="margin-bottom:20"><label style="font-size:16;color:#555555;margin-left:10;">'+(commentList.comment.content ? commentList.comment.content : "")+'</label></row>';
					}
					itemContent += '<row><label style="align:right;color:#b8b8b8;font-size:12">'+commentList.comment.person+'('+commentList.comment.date+')</label></row></col></item>';
				}
			}
			//播放语音
			function playSound(path,filename){
			    commentYuyinUrl =  evoUrl+'/ezOffice/download/playSound.do?url='+path+'&filename='+filename;
			    $http.post(evoUrl + '/ezOffice/download/playSound.do', {
						url : path,
						filename : filename
					}, function(data) {
					   // alert(data);
						$phone.playSound(evoUrl+'/ezOffice/upload/'+filename); 
					},function(error) {
				    if (error == 'timeout') {
						hint('连接服务器超时！');
				    } else if (error == '404') {
						hint('链接超时重新登录！');
				    } else if (error == '500') {
						hint('内部服务器错误！');
				    } else {
						hint('访问网络错误！错误代码:' + error);
				    }
				    $page.open('../index.xml',{animation:'down-to-up'});
				  }
				);
			}
			
			function createCommentCon(workInfo,officeList){
				var isEzFlow = workInfo.isEzFlow;
				var commentField = workInfo.commentField;
				var actiCommFieldType = workInfo.actiCommFieldType;
				if(isEzFlow!='1' ||(actiCommFieldType != '-1' && (commentField == '-1' || commentField == 'nullCommentField' ||
				   commentField == 'autoCommentField' || commentField == 'null' || commentField == null))){
					itemContent += '<item style="padding:0;margin:0;"><col style="background:#f9f9f9;padding:10;margin:10;"><row><label style="align:left;font-size:16;color:#555555">办理意见:</label></row></col></item><item style="padding:0;margin:0;"><col><row>'+
								   '<textarea style="font-size:16;color:#555555" rows="5" name="comment_input" id="comment_input" maxrows="5"></textarea></row></col></item>'+
								   '<item id="" style="col-width:*,40,40,50,40"><col><row onclick="openUseComment(\'' + officeList + '\');"><label style="align:right;color:#C9C9C9;">选择常用语</label></row></col>'+
								   '<col><row><icon id="shouxie" onclick="doDraft();" src="workflow_sx.png" style="display:none;width:30;height:30;"/></row></col>'+
								   '<col><row><icon id="yuyin" onclick="doRecordSound();" src="workflow_yy.png" style="display:none;width:30;height:30;"/></row></col>'+
								   '<col><row>'+
								   '<icon id="commentAdd" src="deskperson_add.png" style="width:30;height:30;align:right;" onclick="openCommentMenu();"/>'+
								   '</row></col></item>'+
								   '<item id="comment_input_sxyy" style="display:none;col-width:40,*,40"></item>';
				}
			}
			
			var drfNum = '0';
			//手写审批
			function doDraft() {
				if(drfNum == "1"){
					alert("不能重复签批！");
					return;
				}
		        $page.graffiti({
		        	type: 'sign',
		            complete: function(path){
		        		$('comment_input_shouxie').value = path;
		        		$('commentType').value = "4";
						var row = $C('<row id="sxrow" style="background:#ffffff"><icon src="'+path+'" style="width:270;height:80;"/><icon id="imageId" src="mail_del.png" style="width:30;height:30;align:right;"/></row>');
						$('comment_input_sxyy').add(row);
						drfNum = "1";
						$('comment_input_sxyy').onclick = 'delrow_sx()';
						$('comment_input_sxyy').css('display','block');
						$('comment_input').css('display','none');
		            }
		        });
		    }
		    
		    //删除手写审批内容
		    function delrow_sx(){
		    	if(!confirm('确定删除手写审批内容？')){
					return false;
				}
		    	$('comment_input_shouxie').value="";
        		$('commentType').value ="0";
        		$('comment_input_sxyy').remove($('sxrow'));
        		drfNum = '0';
        		$('comment_input_sxyy').css('display','none');
        		$('comment_input').css('display','block');
			}
			
			//全屏显示手写审批内容
			function view_sxContent(path){
				$page.open('dealfile_viewBiggraffiti.xml?sxContenturl='+encodeURIComponent(path),{target:'_blank'});
			}
			
		    //语音审批
			function doRecordSound(){
			   if(drfNum == "1"){
					alert("不能重复签批！");
					return;
			   }
	           $phone.recordSound({
	        	    success: function(path) {
	        	  		$('comment_input_yuyin').value=path;
	        			$('commentType').value ="5";
	        			var showpath = path.substring(path.lastIndexOf('/')+1,path.length);
						var row = $C('<row id="yyrow"><label style="color:blue;'+fujianwidth+'">'+showpath+'</label><icon id="imageId" src="mail_del.png" style="width:30;height:30;" onclick="delrow_yy();"/></row>');
						$('comment_input_sxyy').add(row);
						drfNum = "1";
						$('comment_input_sxyy').onclick = 'delrow_yy()';
						$('comment_input_sxyy').css('display','');
						$('comment_input').css('display','none');
	                },
	                error: function() {
	                   hint('录音失败');
	                }
	           });
			}
			//删除语音审批内容
			function delrow_yy(){
				if(!confirm('确定删除语音审批内容？')){
					return false;
				}
				$('comment_input_yuyin').value="";
    			$('commentType').value ="0";
    			$('comment_input_sxyy').remove($('yyrow'));
    			drfNum = '0';
				$('comment_input_sxyy').css('display','none');
				$('comment_input').css('display','block');
			}
			
			// 打开手写签批或语言签批菜单
			function openCommentMenu(){
				var $commentAdd = $('commentAdd');
				if($commentAdd.src == 'deskperson_add.png'){
					$('commentAdd').src = 'workflow_del.png';
					$('shouxie').css('display','');
					$('yuyin').css('display','');
				}else if($commentAdd.src == 'workflow_del.png'){
					$('commentAdd').src = 'deskperson_add.png';
					$('shouxie').css('display','none');
					$('yuyin').css('display','none');
				}
			}
			
			// 打开常用语菜单
	        function openUseComment(officeList) {
	        	if(!officeList){
	        		return false;
	        	}
	        	var officeArray = officeList.split(',');
	        	var actionMenuCon = '<actionmenu title="选择常用语" onclose="">';
	        	officeArray.map(function(office){
	        	    if(office != 'undefined'){
	        			actionMenuCon += '<item label="' + office + '" onclick="setCommentVal(\'' + office + '\')"/>';
	        		}
	        	});
        		actionMenuCon += '</actionmenu>';
	            var menu = $C(actionMenuCon);
	            menu.open();
	        }
	        
	        // 设置意见框中的值
	        function setCommentVal(value){
	        	$('comment_input').value += value;
	        }
	        
        	//创建流程图
	        function createFlowImg(flowGraphUrl,picRootPath){
	        	if(!(flowGraphUrl instanceof Array)){
	        		//var imgPath = webServiceUrl + 'upload/workflow_acc/' + flowGraphUrl + '?rand=' + Math.random();
		        	picRootPath = evoUrl +'/ezOffice/download/resizeHandSign.do?url=' +webServiceUrl + 'upload/workflow_acc/';
	        		var imgPath = picRootPath+flowGraphUrl;
		        	$('flowgraphurl').value = imgPath;
		        	var image = $C('<img src="' + imgPath + '"  id="flowImg" progress="true" style="align:center;height:400;width:300"/>');
		        	$('content_flow_pic').add(image);
	        	}else{
	        		$('tabbar').remove($('imgItem'));
	        		$('contents').remove($('content_flow_pic'));
	        	}
	        }
	        
	        // 打开转办 加签
	        function openPopMenu(modiButton){
	        	if(modiButton.indexOf('Tran') < 0){
		        	$('popupmenu_list').remove($('tranInfoItem'));
	        	}else if(modiButton.indexOf('AddSign') < 0){
		        	$('popupmenu_list').remove($('addSignItem'));
	        	}
	       		$('main_popupmenu').open();
	        }
	        
	         // 创建底部内容
	        function createFootContent(workInfo){
	       	 	var workcurstep = workInfo.workcurstep;
				var modibutton = workInfo.modibutton;
	       	 	// 已阅
		        if(workStatus == '102'){
		        	return false;
		        }
	        	var haveBackButton = workInfo.havebackbutton;
	        	var modiButton = workInfo.modibutton;
	        	var itemContent = '';
	        	storage.setItem('workflow_tableId',workInfo.worktable_id ? workInfo.worktable_id : '');
				storage.setItem('workflow_recordId',workInfo.workrecord_id ? workInfo.workrecord_id : '');
				storage.setItem('workflow_activityId',workInfo.initactivity ? workInfo.initactivity : '');
				storage.setItem('workflow_stepCount',workInfo.workstepcount ? workInfo.workstepcount : '');
				storage.setItem('workflow_isForkTask',workInfo.isForkTask ? workInfo.isForkTask : '');
				storage.setItem('workflow_forkStepCount',workInfo.forkStepCount ? workInfo.forkStepCount : '');
				storage.setItem('workflow_forkId',workInfo.forkId ? workInfo.forkId : '');
				storage.setItem('workflow_smsRight',workInfo.smsRight ? workInfo.smsRight : '');
				var empLivingPhoto = $param['empLivingPhoto'];
				switch(workStatus){
					// 待办
					case '0' : {
			        	if(haveBackButton != 'true'){
							if(modiButton.indexOf('Tran') > 0 || modiButton.indexOf('AddSign') > 0){
									itemContent = 			
							        	'<item style="col-width: 80%,20%">'+
											'<col>'+
												'<row style="height:50;">'+
													'<button onclick="sendFlow(\'' + workInfo.smsRight + '\',\'' + workInfo.worktitle + '\',\'' + workInfo.worksubmittime + '\',\'' + empLivingPhoto + '\');" '+
													'style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:200;height:38;font-size:14">发送</button>'+
												'</row>'+
											'</col>'+
											'<col>'+
									            '<row style="height:50;">'+
													'<button onclick="openPopMenu(\'' + modiButton + '\')" style="align:center;background:workflow_footer_menu.png;width:20;height:20"/>'+
									            '</row>'+
											'</col>'+
										'</item>';
				        		}else{
				        			itemContent = 			
							        	'<item style="">'+
											'<col>'+
												'<row style="height:50;">'+
													'<button onclick="sendFlow(\'' + workInfo.smsRight + '\',\'' + workInfo.worktitle + '\',\'' + workInfo.worksubmittime + '\',\'' + empLivingPhoto + '\');" '+
													'style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:300;height:38;font-size:14">发送</button>'+
												'</row>'+
											'</col>'+
										'</item>';
				        		}
			        	}else{
				        	if(modiButton.indexOf('Tran') > 0 || modiButton.indexOf('AddSign') > 0){
						        	itemContent = 			
							        	'<item style="col-width: 40%,40%,20%">'+
											'<col>'+
									            '<row style="height:50;">'+
									            	'<button onclick="backFlow();" style="align:center;background:null,#90D0FD;color:#90D0FD,white;border:1 #90D0FD;corner-radius:3;width:100;height:38;font-size:14">退回</button>'+
									            '</row>'+
											'</col>'+
											'<col>'+
												'<row style="height:50;">'+
													'<button onclick="sendFlow(\'' + workInfo.smsRight + '\',\'' + workInfo.worktitle + '\',\'' + workInfo.worksubmittime + '\',\'' + empLivingPhoto + '\');" style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:100;height:38;font-size:14">发送</button>'+
												'</row>'+
											'</col>'+
											'<col onclick="openPopMenu(\'' + modiButton + '\')">'+
									            '<row style="height:50;">'+
													'<button onclick="openPopMenu(\'' + modiButton + '\')" style="align:center;background:workflow_footer_menu.png;width:20;height:20"/>'+
									            '</row>'+
											'</col>'+
										'</item>';
				        		}else{
						        	itemContent = 			
							        	'<item style="">'+
											'<col>'+
									            '<row style="height:50;">'+
									            	'<button onclick="backFlow();" style="align:center;background:null,#90D0FD;color:#90D0FD,white;border:1 #90D0FD;corner-radius:3;width:125;height:38;font-size:14">退回</button>'+
									            '</row>'+
											'</col>'+
											'<col>'+
												'<row style="height:50;">'+
													'<button onclick="sendFlow(\'' + workInfo.smsRight + '\',\'' + workInfo.worktitle + '\',\'' + workInfo.worksubmittime + '\',\'' + empLivingPhoto + '\');" style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:125;height:38;font-size:14">发送</button>'+
												'</row>'+
											'</col>'+
										'</item>';
				        		}
			        	}
			        	break;
					}
					// 待阅
					case '2' : {
						itemContent = 			
					        	'<item>'+
									'<col>'+
										'<row style="height:50;">'+
											'<button onclick="sendFlowed();" style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:100;height:40;font-size:14">发送</button>'+
										'</row>'+
									'</col>'+
								'</item>';
						break;
					}
					// 已办
					case '101' : {
						if(workcurstep.indexOf('办理完毕') < 0){
							if(modibutton.indexOf('Undo') > -1 && modibutton.indexOf('Wait') > -1){
								itemContent = 			
						        	'<item style="col-width: 50%,50%">'+
										'<col>'+
								            '<row style="height:50;">'+
								            	'<button onclick="workfolwUndo();" style="align:center;background:null,#90D0FD;color:#90D0FD,white;border:1 #90D0FD;corner-radius:3;width:125;height:40;font-size:14">撤办</button>'+
								            '</row>'+
										'</col>'+
										'<col>'+
											'<row style="height:50;">'+
												'<button onclick="sendFlowAgain();" style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:125;height:40;font-size:14">催办</button>'+
											'</row>'+
										'</col>'+
									'</item>';
							}else if(modibutton.indexOf('Undo') > -1 && modibutton.indexOf('Wait') < 0){
					        	itemContent = 			
						        	'<item>'+
										'<col>'+
											'<row style="height:50;">'+
												'<button onclick="workfolwUndo();" style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:300;height:40;font-size:14">撤办</button>'+
											'</row>'+
										'</col>'+
									'</item>';
							}else if(modibutton.indexOf('Undo') < 0 && modibutton.indexOf('Wait') > -1){
					        	itemContent = 			
						        	'<item>'+
										'<col>'+
											'<row style="height:50;">'+
												'<button onclick="sendFlowAgain();" style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:300;height:40;font-size:14">催办</button>'+
											'</row>'+
										'</col>'+
									'</item>';
							}
						}
						break;
					}
					// 我的文件
					case '1100' : {
						if(workInfo.workcurstep.indexOf('办理完毕') < 0){
							itemContent = 			
					        	'<item>'+
									'<col>'+
										'<row style="height:50;">'+
											'<button onclick="sendFlowAgain();" style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:300;height:38;font-size:14">催办</button>'+
										'</row>'+
									'</col>'+
								'</item>';
						}
						break;
					}
				}
	        	$('footer_list').addMore('<imag><list>' + itemContent + '</list></imag>');
	        }
	        
	        //加载流程记录页面数据
	        var recordLoadFlag = '0';
	        function loadFlowRecord(){
	        	if(recordLoadFlag == '1'){
	        		return false;
	        	}
	        	recordLoadFlag = '1';
				$http.post(
        			evoUrl + '/ezOffice/dealfile/getFlowRecord.do',{workId : workId},
        			function(data){
        				if(!data){
        					alert('查询流程记录失败！');
        					return false;
        				}
        				var jsonData = eval('(' + data + ')');
        				if(jsonData.logonerror &&jsonData.logonerror=='1'){
			         		alert("该账号已在设备"+jsonData.deviceId+"上登录");
		          			$page.open('../index.xml',{target:'_self'});
		                    return;
		                }
        				var data_0 = jsonData.data_0;
        				if(!data_0){
        					alert('查询流程记录失败！');
        					return false;
        				}
        				var result = data_0.message.result;
        				if(result != '1'){
        					alert('查询流程记录失败！');
        					return false;
        				}
        				var recordArray = data_0.data;
        				if(!recordArray){
        					alert('无流程记录！');
        					return false;
        				}
        				var listJson = {items:[]};
	        			var itemJson;
	        			var logReceive;
        				if(recordArray instanceof Array){
        					for(var i=0,length=recordArray.length;i<length;i++){
        						logReceive = recordArray[i].logReceive;
        						if(logReceive instanceof Array){
        							logReceive = '';
        						}else{
        							logReceive = logReceive.replace(',','');
        						}
        						itemJson = {
			                        template : 0,
			                        widgets : {
			                            logUserName : {text : recordArray[i].logUserName},
			                            logTime : {text : recordArray[i].logTime.substring(0,16)},
			                            logAction : {text : recordArray[i].logAction},
			                            logReceive : {text : logReceive}
			                        }
			                    }
			                    listJson.items.push(itemJson);
        					}
        				}else if(recordArray instanceof Object){
        					logReceive = recordArray.log.logReceive;
       						if(logReceive instanceof Array){
       							logReceive = '';
       						}else{
       							logReceive = logReceive.replace(',','');
       						}
							itemJson = {
		                        template : 0,
		                        widgets : {
		                            logUserName : {text : recordArray.log.logUserName},
		                            logTime : {text : recordArray.log.logTime.substring(0,16)},
		                            logAction : {text : recordArray.log.logAction},
		                            logReceive : {text : logReceive}
		                        }
		                    }
		                    listJson.items.push(itemJson);
        				}
        				$('content_flow_record_list').update(listJson);
        			},function(error) {
				    if (error == 'timeout') {
						hint('连接服务器超时！');
				    } else if (error == '404') {
						hint('链接超时重新登录！');
				    } else if (error == '500') {
						hint('内部服务器错误！');
				    } else {
						hint('访问网络错误！错误代码:' + error);
				    }
				    $page.open('../index.xml',{animation:'down-to-up'});
				  }
        		);
	        }
	        
	        // 发送流程 
			function sendFlow(smsRight,workTitle,workSubmitTime,empLivingPhoto){
				var commentType = $('commentType').value;
				var $comment = $('comment_input');
				var commentCon = '';
				if(commentType == '4'){
					commentCon = $('comment_input_shouxie').value;
				}else if(commentType == '5'){
					commentCon = $('comment_input_yuyin').value;
				}else{
					if($comment){
						commentCon = $comment.value;
					}
				}
				var commentIsNone = $('commentmustnonull').value;  //节点中的批示意见是否为空表示，若为true为不能为空
			    if(commentIsNone == 'true'){
			    	 if(commentCon == ''){
			    	 	alert('批示意见不能为空！');
			    	 	return;
			    	 }
			    }
				$('sendForm').action = evoUrl + '/ezOffice/workflow/sendnew.do';
				$('sendForm').submit(function(data) {
					if(!data){
						alert('保存表单失败！');
						return false;
					}
					var dataJson = eval('('+data+')');
					if(dataJson.logonerror &&dataJson.logonerror=='1'){
		         		alert("该账号已在设备"+dataJson.deviceId+"上登录");
	          			$page.open('../index.xml',{target:'_self'});
                        return;
                    }
					var result = dataJson.result;
					if(result == 'success'){
						var isForkTask = $('isForkTask').value;
						// 手写审批、语言批示数据
						var commentShouxie_backName = dataJson.data_1;
						var commentYuyin_backName =  dataJson.data_2;
						$page.open(
						'../workflow/workflow_sendnew.xml?fromXml='+fromXml+'&model='+model
						+'&smsRight='+smsRight+'&workTitle='+encodeURIComponent(workTitle)+
						'&workSubmitTime='+encodeURIComponent(workSubmitTime)+'&empLivingPhoto='+empLivingPhoto+
						'&isForkTask='+isForkTask+'&commentType='+commentType+'&comment='+encodeURIComponent(commentCon)+
						'&commentShouxie_backName='+commentShouxie_backName+'&commentYuyin_backName='+commentYuyin_backName,
						{animation:'down-to-up'});
					}else{
						alert('保存表单失败！');					
					}
	            }, function(error) {
	                alert('提交失败！');
	            });
			}
				        
	        // 退回流程
	        function backFlow(){
	        	var urlParam = $('backForm').serialize()+'&empLivingPhoto=' + $param['empLivingPhoto'];
				$page.open('../workflow/workflow_back.xml?'+urlParam,{animation:'down-to-up'});
	        }
	        
	        // 待阅发送  
			function sendFlowed(){
				$('sendForm').action = evoUrl + '/ezOffice/workflow/readOver.do?workId='+workId;
				$('sendForm').submit(function(data) {
					if(!data){
						alert('保存表单失败！');
						return false;
					}
					var dataJson = eval('('+data+')');
					if(dataJson.logonerror &&dataJson.logonerror=='1'){
		         		alert("该账号已在设备"+dataJson.deviceId+"上登录");
	          			$page.open('../index.xml',{target:'_self'});
                        return;
                    }
					var result = dataJson.result;
					if(result == 'success'){
						alert('发送成功！');
						$page.open('dealfile_index.xml',{animation:'down-to-up'});
					}else{
						alert('发送失败！');					
					}
	            }, function(error) {
	                alert('发送异常！');
	            });
			}
			 
	        // 打开催办页面发送  
			function sendFlowAgain(){
				$page.open('dealfile_pressInfo.xml?'+$('sendFormAgain').serialize(),{animation:'down-to-up'});
			}
			
			// 流程撤办
			function workfolwUndo(){
				$('sendForm').action = evoUrl + '/ezOffice/workflow/workfolwUndo.do?workId='+workId;
				$('sendForm').submit(function(data) {
					if(!data){
						alert('撤办失败！');
						return false;
					}
					var dataJson = eval('('+data+')');
					if(dataJson.logonerror &&dataJson.logonerror=='1'){
		         		alert("该账号已在设备"+dataJson.deviceId+"上登录");
	          			$page.open('../index.xml',{target:'_self'});
                        return;
                    }
					var result = dataJson.result;
					if(result == 'success'){
						alert('撤办成功！');
						$page.open('dealfile_index.xml',{animation:'down-to-up'});
					}else{
						alert('撤办失败！');					
					}
	            }, function(error) {
	                alert('撤办异常！');
	            });
			}
			
			//全屏查看
	        function fullScreenBrowse(){
				var flowgraphurl =$('flowgraphurl').value;
				$page.open('dealfile_viewBigPic.xml?flowgraphurl='+encodeURIComponent(flowgraphurl),{target:'_blank'});
	        }
	        
	        // 转办发送
			function tranInfo(){
				$('main_popupmenu').close();
				$page.open('../workflow/workflow_tranInfo.xml?fromXml='+fromXml+'&workId='+workId+'&workcurstep='+encodeURIComponent($('workcurstep').value),
				{animation:'down-to-up'});
			}
			
			// 加签发送
			function addSign(){
				$('main_popupmenu').close();
				$page.open('../workflow/workflow_addSign.xml?fromXml='+fromXml+'&workId='+workId+'&workcurstep='+encodeURIComponent($('workcurstep').value),
				{animation:'down-to-up'});
			}
        ]]>
    </script>
	<page>
        <title style="background:#3daffe;tint-color:white">
            <left>
            	<button role="back"></button>
            </left>
            <center>
            	<label>物品流程</label>
            </center>
        </title>
        <header id="headers" style="display:none">
        	<tabbar id="tabbar" style="label-color:#b8b8b8,#008eef;indicator-color:#008eef;background:#f9f9f9;">
                <item label="流程表单"></item>
                <item id="imgItem" label="流程图"></item>
                <item label="流程记录" onclick="loadFlowRecord();"></item>
            </tabbar>
        </header>
        <popupmenu id="main_popupmenu" position="bottomright" style="offset-x:5;offset-y:-55">
			<list id="popupmenu_list">
				<item id="tranInfoItem" onclick="tranInfo();"  style="background:#3daffe,#474747;margin:0;padding:0;">
	         		<col><row style="margin:10;padding:10;"><label style="align:center;color:#F0F9FF,white;font-size:14;">转办</label></row></col>
	         	</item>            
	         	<item id="addSignItem" onclick="addSign();"  style="background:#3daffe,#474747;margin:0;padding:0;">
	         		<col><row style="margin:10;padding:10;"><label style="align:center;color:#F0F9FF,white;font-size:14;">加签</label></row></col>
	         	</item>
		    </list>
		</popupmenu>
		<contents id="contents">
            <content style="background:white" id="content_form">
				<form id="sendForm" multipart="true" prompt="请稍后...">
					<input type="hidden" id="__sys_operateType" name="__sys_operateType" value="2"/>
					<input type="hidden" id="__sys_infoId" name="__sys_infoId" value=""/>
					<input type="hidden" id="__sys_pageId" name="__sys_pageId" value=""/>
					<input type="hidden" id="__sys_formType" name="__sys_formType" value=""/>
					<input type="hidden" id="__main_tableName" name="__main_tableName" value=""/>
					<input type="hidden" id="tableId" name="tableId" value=""/>
					<input type="hidden" id="recordId" name="recordId" value=""/>
					<input type="hidden" id="activityId" name="activityId" value=""/>
					<input type="hidden" id="workId" name="workId" value=""/>
					<input type="hidden" id="stepCount" name="stepCount" value=""/>
					<input type="hidden" id="actiCommFieldType" name="actiCommFieldType" value=""/>
					<input type="hidden" id="trantype" name="trantype" value=""/>
					<input type="hidden" id="isForkTask" name="isForkTask" value=""/>
					<input type="hidden" id="forkStepCount" name="forkStepCount" value=""/>
					<input type="hidden" id="forkId" name="forkId" value=""/>
					<input type="hidden" id="activityclass" name="activityclass" value=""/>
					<input type="hidden" id="commentField" name="commentField" value=""/>
					<input type="hidden" id="commentmustnonull" name="commentmustnonull" value=""/>
					<input type="hidden" id="backnocomment" name="backnocomment" value=""/>
					<input type="hidden" id="backMailRange" name="backMailRange" value=""/>
					<input type="hidden" id="smsRight" name="smsRight" value=""/>
					<input type="hidden" id="commentType" name="commentType" value="0"/>
					<input type="file" style="display:none;" id="comment_input_shouxie" name="comment_input_shouxie" value=""/>
					<input type="file" style="display:none;" id="comment_input_yuyin" name="comment_input_yuyin" value=""/>
					<input type="hidden" id="worktitle" name="worktitle" value=""/>
					<input type="hidden" id="workcurstep" name="workcurstep" value=""/>
					<input type="hidden" id="worksubmittime" name="worksubmittime" value=""/>
					<input type="hidden" id="workStatus" name="workStatus" value="0"/>
					<list id="content_form_list">
					</list>
					<list id="subTabel_form_list" style="display:none;">
					</list>
				</form>
				<form id="backForm" prompt="请稍后...">
					<input type="hidden" name="workId" id="back_workId" value=""/>
					<input type="hidden" name="empLivingPhoto" id="back_empLivingPhoto" value=""/>
					<input type="hidden" name="worktitle" id="back_worktitle" value=""/>
					<input type="hidden" name="workcurstep" id="back_workcurstep" value=""/>
					<input type="hidden" name="worksubmittime" id="back_worksubmittime" value=""/>
					<input type="hidden" name="workStatus" id="back_workStatus" value="0"/>
					<input type="hidden" name="tableId" id="back_tableId" value=""/>
					<input type="hidden" name="recordId" id="back_recordId" value=""/>
					<input type="hidden" name="stepCount" id="back_stepCount" value=""/>
					<input type="hidden" name="forkId" id="back_forkId" value=""/>
					<input type="hidden" name="forkStepCount" id="back_forkStepCount" value=""/>
					<input type="hidden" name="isForkTask" id="back_isForkTask" value=""/>
					<input type="hidden" name="curCommField" id="back_curCommField" value="" />
					<input type="hidden" name="backWorkProcessId" id="back_backWorkProcessId" value="" />
					<input type="hidden" name="workType" id="back_workType" value="" />
					<input type="hidden" name="workMainLinkFile" id="back_workMainLinkFile" value="" />
					<input type="hidden" name="workSubmitPerson" id="back_workSubmitPerson" value="" />
					<input type="hidden" name="workactivity" id="back_workActivity" value="" />
					<input type="hidden" name="standForUserid" id="back_standForUserid" value="" />
					<input type="hidden" name="isStandForWork" id="back_isStandForWork" value="" />
				</form>
				<form id="sendFormAgain" prompt="请稍后...">
					<input type="hidden" name="workId" id="again_workId" value=""/>
					<input type="hidden" name="empLivingPhoto" id="again_empLivingPhoto" value=""/>
					<input type="hidden" name="worktitle" id="again_worktitle" value=""/>
					<input type="hidden" name="workcurstep" id="again_workcurstep" value=""/>
					<input type="hidden" name="worksubmittime" id="again_worksubmittime" value=""/>
					<input type="hidden" name="workStatus" id="again_workStatus" value="1100"/>
				</form>
				
				<form id="tranInfoForm">
					<input type="hidden" name="empLivingPhoto" id="tran_empLivingPhoto" value=""/>
					<input type="hidden" name="worktitle" id="tran_worktitle" value=""/>
					<input type="hidden" name="workcurstep" id="tran_workcurstep" value=""/>
					<input type="hidden" name="worksubmittime" id="tran_worksubmittime" value=""/>
					<input type="hidden" name="workStatus" id="tran_workStatus" value="0"/>
				</form>
				<form id="addSignForm">
					<input type="hidden" name="empLivingPhoto" id="addSign_empLivingPhoto" value=""/>
					<input type="hidden" name="worktitle" id="addSign_worktitle" value=""/>
					<input type="hidden" name="workcurstep" id="addSign_workcurstep" value=""/>
					<input type="hidden" name="worksubmittime" id="addSign_worksubmittime" value=""/>
					<input type="hidden" name="workStatus" id="addSign_workStatus" value="0"/>
				</form>
				
            </content>
            <content style="background:white" id="content_flow_pic">
            	<input type="hidden" name="flowGraphUrl" id="flowgraphurl" value="" />
            	<button onclick="fullScreenBrowse();" id="bottonselect" target="_blank">全屏查看</button>
            </content>
            <content style="background:white" id="content_flow_record">
            	<list id="content_flow_record_list" reuse="true">
        			<item style="col-width:22%,2%,36%,2%,31%,7%;" >
            			<col>
            				<row>
            					<label reusekey="logUserName" style="color:#555555;align:left"></label>
            				</row>
            				<row><label reusekey="logTime" style="align:left;font-size:8;color:#B8b8b8"></label></row>
            			</col>
            			<col>
            			</col>
            			<col>
            				<row>
            					<label reusekey="logAction" style="align:left;font-size:10;color:#38adff"></label>
            				</row>
            			</col>
            			<col>
            			</col>
            			<col>
            				<row>
            					<label reusekey="logReceive" style="align:left;color:#555555;padding-right:2"></label>
            				</row>
            			</col>
            			<col>
            			</col>
            		</item>
            	</list>
            </content>
        </contents>
		<footer id="footer" style="background:#F9F9F9">
			<list type="toolbar" id="footer_list">
			</list>
			<list id="subTable_footer_list">
			</list>
        </footer>
	</page>
</imag>