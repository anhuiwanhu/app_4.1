<?xml version="1.0" encoding="utf-8"?>
<imag>
    <script>
        <![CDATA[
            var isvideoFlag=''; //发送时判断是否点数 yes，no
            var maxNumber = 0; //点数最大值
	        
	        var info = $phone.info();
            var fujianwidth='';
            if(info['platform']=='android'){
              fujianwidth='width:200';
            }
            var fileTotle = 0 ;  //附件最多能上传5个
	        var fileindex =0;    //附件id标识
            var fileAddressArr = new Array();
            var fileTypeArr = new Array();   //附件上传时，存储对应数组fileAddressArr中的类型。pic:图片类型，sound：声音类型，file：其他附件类型
	        
	        function getAttanchNum(){
				if(fileTotle>=10){
					hint('上传附件不能超过10个！');
					return false;
				}
				return true;
			}
			function doRelatedAcc(file,appendId,sysname){   
		       	 var menu = $C('<actionmenu cancelTitle="取消">' +
								 '<item style="text-decoration:underline;" label="拍照"     onclick="doFileCamera(this,\'' + appendId + '\',\'' + sysname + '\')"/>' +
								 '<item style="text-decoration:underline;" label="相册照片" onclick="doFilePhotoAlbum(this,\'' + appendId + '\',\'' + sysname + '\')"/>' +
								 '<item style="text-decoration:underline;" label="录音文件" onclick="doFileRecordSound(this,\'' + appendId + '\',\'' + sysname + '\')"/>' +
								 '<item style="text-decoration:underline;" label="其他文件" onclick="doFileBrowse(this,\'' + appendId + '\',\'' + sysname + '\')"/>' +
							'</actionmenu>');
		               menu.show();
		    }
		    function doFilePhotoAlbum(file,appendId,sysname){    //上传文件选择相册
				    if(!getAttanchNum()){
						return;
					}
					$page.browseImage({
						complete: function(path) {
						 	var showpath = path.substring(path.lastIndexOf('/')+1,path.length);
                            var row = $C('<row id="row' + fileindex + '"><icon style="padding-left:20;width:20;height:25;" src="mail_fujian.png"/>'+
						    '<label id="attachmentId' + fileindex + '" style="color:blue;'+fujianwidth+'">' + showpath + '</label>'+
						    '<icon id="imageId" src="mail_del.png" style="width:12;height:12;" onclick="delrow(\'' + fileindex + '\',\'' + appendId + '\');"/></row>');
						    $(appendId).add(row);
						    $('content_form_list').addMore('<imag><list><item><row><input type="file" style="display:none;" value="' + path + '" name="attachment"  id="input_file' + fileindex + '"/></row></item></list></imag>');
				            
				        	fileindex++;
				        	fileTotle++;
				        },
				        error: function() {
				            hint('上传图片失败！');
				        }
					  });
		     }
		 function doFileCamera(file,appendId,sysname) {  //拍照
			if(!getAttanchNum()){
				return;
			}
		    $phone.camera({
		        success: function(path) {
		        	var showpath = path.substring(path.lastIndexOf('/')+1,path.length);
		        	var row = $C('<row id="row' + fileindex + '"><icon style="padding-left:20;width:20;height:25;" src="mail_fujian.png"/>'+
						    '<label id="attachmentId' + fileindex + '" style="color:blue;'+fujianwidth+'">' + showpath + '</label>'+
						    '<icon id="imageId" src="mail_del.png" style="width:12;height:12;" onclick="delrow(\'' + fileindex + '\',\'' + appendId + '\');"/></row>');
						    $(appendId).add(row);
						    $('content_form_list').addMore('<imag><list><item><row><input type="file" style="display:none;" value="' + path + '" name="attachment"  id="input_file' + fileindex + '"/></row></item></list></imag>');
				      
		        	fileindex++;
		        	fileTotle++;
		        },
		        error: function() {
		            hint('拍照失败！');
		        }
		    });
		}
		
		 function doFileRecordSound(file,appendId,sysname) {
			if(!getAttanchNum()){
				return;
			}
		    $phone.recordSound({
		        success: function(path) {
		        	var showpath = path.substring(path.lastIndexOf('/')+1,path.length);
		        	var row = $C('<row id="row' + fileindex + '"><icon style="padding-left:20;width:20;height:25;" src="mail_fujian.png"/>'+
						    '<label id="attachmentId' + fileindex + '" style="color:blue;'+fujianwidth+'">' + showpath + '</label>'+
						    '<icon id="imageId" src="mail_del.png" style="width:12;height:12;" onclick="delrow(\'' + fileindex + '\',\'' + appendId + '\');"/></row>');
						    $(appendId).add(row);
						    $('content_form_list').addMore('<imag><list><item><row><input type="file" style="display:none;" value="' + path + '" name="attachment"  id="input_file' + fileindex + '"/></row></item></list></imag>');
				      
		        	fileindex++;
		        	fileTotle++;
		        },
		        error: function() {
		            hint('录音失败！');
		        }
		    });
		}
		function doFileBrowse(file,appendId,sysname) { //附件上传
				if (!getAttanchNum()) {
					return;
				}
				$page.browse({
					complete: function(path) {
						var showpath = path.substring(path.lastIndexOf('/') + 1, path.length);
						if (showpath.indexOf(".") == -1) {
							hint("无后缀名的附件不允许上传，请重新选择");
							return false;
						}
						var filenameExt = path.substring(path.lastIndexOf('\.')+1,path.length);
			        	if(filenameExt == 'exe'){
			        	    hint("后缀名为exe的附件不允许上传，请重新选择");
			        		return false;
			        	}
			        	if(filenameExt == 'cmd'){
			        	    hint("后缀名为cmd的附件不允许上传，请重新选择");
			        		return false;
			        	}
			        	if(filenameExt == 'jsp'){
			        	    hint("后缀名为jsp的附件不允许上传，请重新选择");
			        		return false;
			        	}
						var row = $C('<row id="row' + fileindex + '"><icon style="padding-left:20;width:20;height:25;" src="mail_fujian.png"/>'+
						'<label id="attachmentId' + fileindex + '" style="color:blue;'+fujianwidth+'">' + showpath + '</label>'+
						'<icon id="imageId" src="mail_del.png" style="width:12;height:12;" onclick="delrow(\'' + fileindex + '\',\'' + appendId + '\');"/></row>');
						$(appendId).add(row);
						//$('input_file'+fileindex).value = path;
						$('content_form_list').addMore('<imag><list><item><row><input type="file" style="display:none;" value="' + path + '" name="attachment"  id="input_file' + fileindex + '"/></row></item></list></imag>');
						fileindex++;
						fileTotle++;
					}
				});
			}
			
			function delrow(index,appendId) { //删除附件
				if (confirm('确认删除附件吗？')) {
					$('input_file' + index).value = "";
					$(appendId).remove($('row' + index));
					fileTotle--;
				}
			}
		
        	//流程id---在打开流程表单页时设置的数据 保存在客户端本地
        	var storage;
        	var evoUrl;
        	(function(){
        		storage = $phone.localStorage();
	           	evoUrl = storage.getItem('evoUrl');
        	})();
        	var orgId = storage.getItem('sys_orgId');
        	var itemContent = '';
        	var model = $param['model'];
        	$page.onload = function(){
        		var centerTitle_str =  decodeURIComponent($param['processName']);
        	    if(centerTitle_str.length>15){
        	      centerTitle_str = centerTitle_str.substring(0,15)+'...';
        	    }
        		$('centerTitle').text = centerTitle_str;
        		$http.post(
        			evoUrl + '/ezOffice/boardroom/newInfo.do',{pageId : decodeURIComponent($param['pageId']) , processId : decodeURIComponent($param['processId'])},
        			function(data){
        				if(!data){
        					alert('数据获取失败！');
        				}
        				data = data.replace(/\&/g,'＆');
        				var jsonData = eval('(' + data + ')');
        				if(jsonData.logonerror &&jsonData.logonerror=='1'){
			         		alert("该账号已在设备"+jsonData.deviceId+"上登录");
		          			$page.open('../index.xml',{target:'_self'});
		                    return;
		                }
        				var result = jsonData.message.result;
        				if(result != '1'){
        					alert('数据获取失败！');
        					return;
        				}
        				var fieldList = jsonData.data.fieldList;
        				var $contentFormList = $('content_form_list');
        				var selectContent = '';
       					//初始化表单数据
        				if(fieldList instanceof Array){
        					for(var i=0,length=fieldList.length;i<length;i++){
        						createFormData(fieldList[i]);
        					}
        				}else if(fieldList instanceof Object){
       						createFormData(fieldList);
        				}
       					$contentFormList.addMore('<imag><list>' + itemContent + '</list></imag>');
       					// 创建工作流程信息隐藏域
						createWorkInfoHiddenArea();
       					// 创建底部内容
       					createFootContent();
       					//点数与地点切换
       					getAddrOrPoints();
        			},function(error) {
				    if (error == 'timeout') {
						hint('连接服务器超时！');
				    } else if (error == '404') {
						hint('链接超时重新登录！');
				    } else if (error == '500') {
						hint('内部服务器错误！');
				    } else {
						hint('访问网络错误！错误代码:' + error);
				    }
				  }
        		);
	        }
	        
	       // 创建工作流程信息隐藏域
	        function createWorkInfoHiddenArea(){
	        	$('sysPageId').value = decodeURIComponent($param['pageId']);
	        	$('processId').value = decodeURIComponent($param['processId']);
	        }
	        
	        // 创建底部内容
	        function createFootContent(){
				itemContent = 			
		        	'<item style="col-width: 100%">'+
						'<col>'+
							'<row style="height:50;">'+
								'<button onclick="sendFlow();" '+
								'style="align:center;background:#3EAFFF,#007aff;color:#F0F9FF,white;border:0;corner-radius:3;width:300;height:38;font-size:14">发送</button>'+
							'</row>'+
						'</col>'+
					'</item>';
	        	$('footer_list').addMore('<imag><list>' + itemContent + '</list></imag>');
	        }

			
	        //必填标识
	        var mustfilled;
	        //必填项数组
	        var mustFillCon = new Array();
	        //添加数组元素 
	        function pushMustFillArray(mustfilled,fieldName,conId){
	        	if(mustfilled != '1'){
	        		return false;
	        	}
	        	mustFillCon.push(fieldName + ';' + conId);
	        }
	        
	        //必填checkbox
	        var mustFillCheckbox = new Array();
	        //添加数组元素 
	        function pushMustFillCheckboxArray(mustfilled,fieldName,conId,len){
	        	if(mustfilled == '0'){
	        		return false;
	        	}
	        	mustFillCheckbox.push(fieldName + ';' + conId+ ';' +len);
	        }
	        //不能编辑的必填字段
	        var mustFillWord = new Array();
	        //添加数组元素 
	        function pushMustFillWord(mustfilled,fieldName,conId){
	        	if(mustfilled == '0'){
	        		return false;
	        	}
	        	mustFillWord.push(fieldName + ';' + conId);
	        }
	        
	        //新增会议时间数量字段
	        var boardDateIndex = 0; 
	        function addMeetingTime(){
	             var oDate = new Date(); //实例一个时间对象；
				 var year = oDate.getFullYear();   //获取系统的年；
				 var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
				 if(month<10){
					month = 0+""+month;
				 }
				 var date = oDate.getDate(); // 获取系统日
				 if(date<10){
					date = 0+""+date;
				}
	            $('destineDate').add($C('<row id="destineDate'+boardDateIndex+'"><input style="color:#555555;font-size:16;" type="date" id="_main_destineDate'+boardDateIndex+'" name="_main_destineDate'+boardDateIndex+'" value="'+year+'-'+month+'-'+date+'" /><icon src="mail_del.png" style="width:28;height:28;margin-left:10;" onclick="deleteBoardDate(\''+boardDateIndex+'\');"/></row>'));  //日期增加一行
	            $('startMinute').add($C('<row id="startMinute'+boardDateIndex+'"><input style="color:#555555;font-size:16;" type="time" id="_main_startMinute'+boardDateIndex+'" name="_main_startMinute'+boardDateIndex+'" value="09:00" format="HH:mm"/></row>'));  //开始时分增加一行
	       		$('endMinute').add($C('<row id="endMinute'+boardDateIndex+'"><input style="color:#555555;font-size:16;" type="time" id="_main_endMinute'+boardDateIndex+'" name="_main_endMinute'+boardDateIndex+'" value="09:30" format="HH:mm" /></row>'));  //结束增加一行
	            boardDateIndex++;
	        }
	        
	        function deleteBoardDate(index){   //删除方法
	           $('_main_destineDate'+index).value='';
	           $('_main_startMinute'+index).value='';
	           $('_main_endMinute'+index).value='';
	           $('destineDate').remove($('destineDate'+index));
	           $('startMinute').remove($('startMinute'+index));
	           $('endMinute').remove($('endMinute'+index));
	        }
	        
	        //发送时验证表单
	        function checkForm(){
	        	var fieldInfoArray;
	        	var flag = true;
	        	for(var i=0,length=mustFillCon.length;i<length;i++){
	        		if(!mustFillCon[i]){
	        			return false;
	        		}
	        		fieldInfoArray = mustFillCon[i].split(';');
	        		if(!($(fieldInfoArray[1]).value)){
	        			alert(fieldInfoArray[0] + ' 不能为空！');
			        	return false;
	        		}
	        	}
	        	for(var i=0,length=mustFillCheckbox.length;i<length;i++){
	        		if(!mustFillCheckbox[i]){
	        			return false;
	        		}
	        		var chefieldInfoArray = mustFillCheckbox[i].split(';');
	        		var fname = chefieldInfoArray[0];
	        		var conId = chefieldInfoArray[1];
	        		var len = eval(chefieldInfoArray[2]);
	        		
	        		flag = false;
	        		for(var j=0;j<len;j++){
	        		    if(($(conId+j).checked)){
	        		        flag = true;
		        		}
	        		}
	        		if(!flag){
	        		   alert(fname + ' 不能为空！');
	        		   return false;
	        		}
	        		
	        	}
	        	for(var i=0,length=mustFillWord.length;i<length;i++){
	        		if(!mustFillWord[i]){
	        			return false;
	        		}
	        		var mustFillWordArray = mustFillWord[i].split(';');
	        		alert(mustFillWordArray[0] + ' 不能在手机编辑，请于pc端操作！');
	        		return false;
	        	}
	        	return flag;
	        }
	        
	        //初始化表单数据
	        function createFormData(field){
	        	mustfilled = field.mustfilled;
	        	var mustfilled_view = '';
        	    if(mustfilled && mustfilled=='1'){
        	       mustfilled_view = '<label style="align:left;font-size:12;color:#FF4617">*</label>';
        	    }
        	    if(field.boardroomCode != null && field.boardroomCode != ''){  //单行文本
        	        itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' +field.boardroomCode + ':</label></row></col><col style="padding:10;margin:10;">';
        	    	itemContent += '<row><input style="color:#555555;font-size:16;" type="text" id="_main_boardroomCode" name="_main_boardroomCode" value=""/></row>';
        	    	itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,field.boardroomCode,'_main_boardroomCode');
        	    }else if(field.boardroomApplyType != null && field.boardroomApplyType != ''){  //下拉框，会议类型
        	    	itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' + field.boardroomApplyType + ':</label></row></col><col style="padding:10;margin:10;">';
	        		//下拉框
	        		selectContent = '<row><select style="font-size:16;" id="_main_boardroomApplyType" name="_main_boardroomApplyType">';
	        		for(var index=0,size=field.dataList.length;index<size;index++){
		        		if(field.hiddenval){
			        		if(field.hiddenval == field.dataList[index].hiddenval){
			        			selectContent += '<option  value="'+field.dataList[index].hiddenval+'">'+field.dataList[index].showval+'</option>';
			        		}else{
			        			selectContent += '<option value="'+field.dataList[index].hiddenval+'">'+field.dataList[index].showval+'</option>';
			        		}
		        		}else{
		        			selectContent += '<option value="'+field.dataList[index].hiddenval+'">'+field.dataList[index].showval+'</option>';
		        		}
	        		}
	        		selectContent += '</select>';
	        		itemContent += selectContent + '</row>';
	        		itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,field.boardroomApplyType,'_main_boardroomApplyType');
        	    }else if(field.motif != null && field.motif != ''){  //单行文本
        	        itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' +field.motif + ':</label></row></col><col style="padding:10;margin:10;">';
        	    	itemContent += '<row><input style="color:#555555;font-size:16;" type="text" id="_main_motif" name="_main_motif" value=""/></row>';
        	    	itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,field.motif,'_main_motif');
        	    }else if(field.depict != null && field.depict != ''){  //多行文本，会议内容
        	    	itemContent += '<item style="padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' +field.depict + ':</label></row></col></item><item style="padding:0;margin:0;"><col>';
        	    	itemContent += '<row><textarea style="color:#555555;font-size:16;" rows="5" maxrows="5" id="_main_depict" name="_main_depict"></textarea></row>';
        	    	itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,field.depict,'_main_depict');
        	    }else if(field.emceeName != null && field.emceeName != ''){  //主持人
        	    	itemContent += '<item onclick="selectUser(\'_main_emceeName\',\'_mainShow_emceeName\',\'*0*\',\'1\')" style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' + field.emceeName + ':</label></row></col><col style="padding:10;margin:10;">';
	        		//多选人 全部
	        		itemContent += '<row>'+
	        					   '<input onclick="selectUser(\'_main_emceeName\',\'_mainShow_emceeName\',\'*0*\',\'1\')" style="color:#555555;font-size:16;" readonly="true" type="text" name="_mainShow_emceeName'  + 
	        					   '" value="" id="_mainShow_emceeName" placeholder="请选择>" />'+
	        					   '<input type="hidden" id="_main_emceeName" name="_main_emceeName" value=""/></row>';
	        		itemContent += '</col></item>';
	        		pushMustFillArray(mustfilled,field.emceeName,'_main_emceeName');
        	    }else if(field.personNum != null && field.personNum != ''){  //单行文本出席人数
        	        itemContent += '<item  style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' + field.personNum + ':</label></row></col><col style="padding:10;margin:10;">';
        	    	itemContent += '<row><input style="color:#555555;font-size:16;" type="number" id="_main_personNum" name="_main_personNum" value="" /></row>';
        	    	itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,field.personNum,'_main_personNum');
        	    }else if(field.attendeeLeader != null && field.attendeeLeader != ''){   //出席领导
	        		itemContent += '<item onclick="selectUser(\'_main_attendeeLeader\',\'_mainShow_attendeeLeader\',\'*0*\',\'1\')" style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' + field.attendeeLeader + ':</label></row></col><col style="padding:10;margin:10;">';
	        		//多选人 全部
	        		itemContent += '<row >'+
	        					   '<input onclick="selectUser(\'_main_attendeeLeader\',\'_mainShow_attendeeLeader\',\'*0*\',\'1\')" style="color:#555555;font-size:16;" readonly="true" type="text" name="_mainShow_attendeeLeader' + 
	        					   '" value="" id="_mainShow_attendeeLeader" placeholder="请选择>" />'+
	        					   '<input type="hidden" id="_main_attendeeLeader" name="_main_attendeeLeader" value=""/></row>';
	        		itemContent += '</col></item>';
	        		pushMustFillArray(mustfilled,field.attendeeLeader,'_main_attendeeLeader');
	        	}else if(field.notePersonName != null && field.notePersonName != ''){   //会议记录人
	        		itemContent += '<item onclick="selectUser(\'_main_notePersonName\',\'_mainShow_notePersonName\',\'*0*\',\'1\')" style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' + field.notePersonName + ':</label></row></col><col style="padding:10;margin:10;">';
	        		//多选人 全部
	        		itemContent += '<row >'+
	        					   '<input onclick="selectUser(\'_main_notePersonName\',\'_mainShow_notePersonName\',\'*0*\',\'1\')" style="color:#555555;font-size:16;" readonly="true" type="text" name="_mainShow_notePersonName' + 
	        					   '" value="" id="_mainShow_notePersonName" placeholder="请选择>" />'+
	        					   '<input type="hidden" id="_main_notePersonName" name="_main_notePersonName" value=""/></row>';
	        		itemContent += '</col></item>';
	        		pushMustFillArray(mustfilled,field.notePersonName,'_main_notePersonName');
	        	}else if(field.meetingTimeList != null && field.meetingTimeList != ''){  //时间日期
	        	    var oDate = new Date(); //实例一个时间对象；
					var year = oDate.getFullYear();   //获取系统的年；
					var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
					if(month<10){
						month = 0+""+month;
					}
					var date = oDate.getDate(); // 获取系统日
					if(date<10){
						date = 0+""+date;
					}
	        	    itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' +field.meetingTimeList.destineDate + ':</label></row></col><col style="padding:10;margin:10;" id="destineDate">';
        	    	itemContent += '<row><input style="color:#555555;font-size:16;" type="date" id="_main_destineDate" name="_main_destineDate" value="'+year+'-'+month+'-'+date+'"  /><icon src="mail_addfu.png" style="width:28;height:28;margin-left:10;" onclick="addMeetingTime();"/></row></col></item>';
	        	    itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' +field.meetingTimeList.startMinute + ':</label></row></col><col style="padding:10;margin:10;" id="startMinute">';
        	    	itemContent += '<row><input style="color:#555555;font-size:16;" type="time" id="_main_startMinute" name="_main_startMinute" value="09:00" format="HH:mm"/></row></col></item>';
        	    	itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' +field.meetingTimeList.endMinute + ':</label></row></col><col style="padding:10;margin:10;" id="endMinute">';
        	    	itemContent += '<row><input style="color:#555555;font-size:16;" type="time" id="_main_endMinute" name="_main_endMinute" value="09:30" format="HH:mm" /></row>';
        	    	itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,field.meetingTimeList.destineDate,'_main_destineDate');
        	    	pushMustFillArray(mustfilled,field.meetingTimeList.startMinute,'_main_startMinute');
        	    	pushMustFillArray(mustfilled,field.meetingTimeList.endMinute,'_main_endMinute');
        	    }else if(field.boardroomName != null && field.boardroomName != ''){  //会议室名称，单选
        	    	itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' + field.boardroomName + ':</label></row></col><col style="padding:10;margin:10;">';
	        		//下拉框
	        		selectContent = '<row><select style="font-size:16;" id="_main_boardroomName" name="_main_boardroomName" onchange="getAddrOrPoints()">';
	        		for(var index=0,size=field.dataList.length;index<size;index++){
		        		if(field.dataList){
			        		selectContent += '<option value="'+field.dataList[index].hiddenval+'|'+field.dataList[index].showval+'|'+field.dataList[index].maxNumber+'|'+field.dataList[index].isvideo+'">'+field.dataList[index].showval+'</option>';
		        		}
	        		}
	        		selectContent += '</select>';
	        		itemContent += selectContent + '</row>';
        	    	itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,field.boardroomName,'_main_boardroomName');
        	    }else if(field.addr != null && field.addr != ''){  //单行文本，会议地点
        	        itemContent += '<item style="col-width:100,*;padding:0;margin:0;" id="addrId"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555" id="lab_addrId">' +field.addr + ':</label></row></col><col style="padding:10;margin:10;">';
        	    	itemContent += '<row><input style="color:#555555;font-size:16;" type="text" id="_main_addr" name="_main_addr" value=""/></row>';
        	    	itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,field.addr,'_main_addr');
        	    	itemContent += '<item style="col-width:100,*;padding:0;margin:0;display:none;" id="pointsId"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">点数 :</label></row></col><col style="padding:10;margin:10;">';
        	    	itemContent += '<row><input style="color:#555555;font-size:16;" type="text" id="_main_points" name="_main_points" value="0"/></row>';
        	    	itemContent += '</col></item>';
        	    }else if(field.points != null && field.points != ''){  //单行文本，点数，返回数据中地点与点数二选一,点数默认是0
        	        itemContent += '<item style="col-width:100,*;padding:0;margin:0;display:none;" id="addrId"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">地点:</label></row></col><col style="padding:10;margin:10;">';
        	    	itemContent += '<row><input style="color:#555555;font-size:16;" type="text" id="_main_addr" name="_main_addr" value=""/></row>';
        	    	itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,field.addr,'_main_addr');
        	        itemContent += '<item style="col-width:100,*;padding:0;margin:0;" id="pointsId"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' +field.points + ':</label></row></col><col style="padding:10;margin:10;">';
        	    	itemContent += '<row><input style="color:#555555;font-size:16;" type="text" id="_main_points" name="_main_points" value="0"/></row>';
        	    	itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,field.points,'_main_points'); 
        	    }else if(field.attendee != null && field.attendee != ''){   //出席人
	        		itemContent += '<item onclick="selectUser(\'_main_attendee\',\'_mainShow_attendee\',\'*0*\',\'1\')" style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' + field.attendee + ':</label></row></col><col style="padding:10;margin:10;">';
	        		//多选人 全部
	        		itemContent += '<row >'+
	        					   '<input onclick="selectUser(\'_main_attendee\',\'_mainShow_attendee\',\'*0*\',\'1\')" style="color:#555555;font-size:16;" readonly="true" type="text" name="_mainShow_attendee' + 
	        					   '" value="" id="_mainShow_attendee" placeholder="请选择>" />'+
	        					   '<input type="hidden" id="_main_attendee" name="_main_attendee" value=""/></row>';
	        		itemContent += '</col></item>';
	        		pushMustFillArray(mustfilled,field.attendee,'_main_attendee');
	        	}else if(field.otherAttendeePerson != null && field.otherAttendeePerson != ''){   //其他参会人员
	        		itemContent += '<item style="padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' +field.otherAttendeePerson + ':</label></row></col></item><item style="padding:0;margin:0;"><col>';
        	    	itemContent += '<row><textarea style="color:#555555;font-size:16;" rows="5" maxrows="5" id="_main_otherAttendeePerson" name="_main_otherAttendeePerson"></textarea></row>';
        	    	itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,field.otherAttendeePerson,'_main_otherAttendeePerson');
	        	}else if(field.swPerson != null && field.swPerson != ''){   //单位收文员
	        		itemContent += '<item onclick="selectUser(\'_main_swPerson\',\'_mainShow_swPerson\',\'*0*\',\'1\')" style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' + field.swPerson + ':</label></row></col><col style="padding:10;margin:10;">';
	        		//多选人 全部
	        		itemContent += '<row >'+
	        					   '<input onclick="selectUser(\'_main_swPerson\',\'_mainShow_swPerson\',\'*0*\',\'1\')" style="color:#555555;font-size:16;" readonly="true" type="text" name="_mainShow_swPerson' + 
	        					   '" value="" id="_mainShow_swPerson" placeholder="请选择>" />'+
	        					   '<input type="hidden" id="_main_swPerson" name="_main_swPerson" value=""/></row>';
	        		itemContent += '</col></item>';
	        		pushMustFillArray(mustfilled,field.swPerson,'_main_swPerson');
	        	}else if(field.applyEmpName != null && field.applyEmpName != ''){  //预订者，只读数据
        	        itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' +field.applyEmpName + ':</label></row></col><col style="padding:10;margin:10;">';
        	    	itemContent += '<row><label style="color:#555555;font-size:16;">'+field.value+'</label>'+
        	    	 '<input type="hidden" id="_main_applyEmpName" name="_main_applyEmpName" value="'+field.hiddenval+'"/></row>';
        	    	itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,'applyEmpName','_main_applyEmpName');
        	    }else if(field.applyOrgName != null && field.applyOrgName != ''){  //预订部门，只读数据
        	        itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' +field.applyOrgName + ':</label></row></col><col style="padding:10;margin:10;">';
        	    	itemContent += '<row><label style="color:#555555;font-size:16;">'+field.value+'</label>'+
        	    	 '<input type="hidden" id="_main_applyOrgId" name="_main_applyOrgId" value="'+field.hiddenval+'"/>'+
        	    	 '<input type="hidden" id="_main_applyOrgName" name="_main_applyOrgName" value="'+field.value+'"/></row>';
        	    	itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,field.applyEmpName,'_main_applyOrgName');
        	    }else if(field.applyDate != null && field.applyDate != ''){  //预定日期
        	        var oDate = new Date(); //实例一个时间对象；
					var year = oDate.getFullYear();   //获取系统的年；
					var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
					if(month<10){
						month = 0+""+month;
					}
					var date = oDate.getDate(); // 获取系统日
					if(date<10){
						date = 0+""+date;
					}
        	    	itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' +field.applyDate + ':</label></row></col><col style="padding:10;margin:10;">';
        	    	itemContent += '<row><input style="color:#555555;font-size:16;" type="date" id="_main_applyDate" name="_main_applyDate" value="'+year+'-'+month+'-'+date+'"  /></row>';
        	    	itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,field.applyDate,'_main_applyDate');
        	    }else if(field.linkTelephone != null && field.linkTelephone != ''){  //单行文本，联系电话
        	        itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' +field.linkTelephone + ':</label></row></col><col style="padding:10;margin:10;">';
        	    	itemContent += '<row><input style="color:#555555;font-size:16;" type="number" id="_main_linkTelephone" name="_main_linkTelephone" value=""/></row>';
        	    	itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,'linkTelephone','_main_linkTelephone');
        	    }else if(field.checkboxList != null && field.checkboxList != ''){   //提醒
	        		itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555"> 提醒:</label></row></col><col style="padding:10;margin:10;">';
	        		selectContent = '';
	        		//多选
	        		var remindArr = field.checkboxList;
	        		remindIndex = remindArr.length;
	        		for(var index=0,size=remindArr.length;index<size;index++){
	        		    selectContent += '<row>';
						if(remindArr[index].hiddenval == 'mail'){
		        			selectContent += '<checkbox style="align:left;font-size:16;" id="_main_remind_im' +index+ '"  disabled="disabled" checked="true" >'+remindArr[index].showval+'</checkbox>';
		        		}else{
		        			selectContent += '<checkbox style="align:left;font-size:16;" id="_main_remind_im' + index+ '"  value="'+remindArr[index].hiddenval+'" >'+remindArr[index].showval+'</checkbox>';
		        		}
		        		selectContent += '</row>';
	        		}
	        		itemContent += selectContent;
	        		itemContent += '<input type="hidden" name="_main_remind_im" id="_main_remind_im" value=""/></col></item>';
	        		//pushMustFillCheckboxArray(mustfilled,'提醒','_main_remind_im',remindArr.length);
	        	}else if(field.seatcard != null && field.seatcard != ''){  //多行文本，席卡
        	    	itemContent += '<item style="padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' +field.seatcard + ':</label></row></col></item><item style="padding:0;margin:0;"><col>';
        	    	itemContent += '<row><textarea style="color:#555555;font-size:16;" rows="5" maxrows="5" id="_main_seatcard" name="_main_seatcard"></textarea></row>';
        	    	itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,field.seatcard,'_main_seatcard');
        	    }else if(field.remark != null && field.remark != ''){  //多行文本，备注
        	    	itemContent += '<item style="padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' +field.remark + ':</label></row></col></item><item style="padding:0;margin:0;"><col>';
        	    	itemContent += '<row><textarea style="color:#555555;font-size:16;" rows="5" maxrows="5" id="_main_remark" name="_main_remark"></textarea></row>';
        	    	itemContent += '</col></item>';
        	    	pushMustFillArray(mustfilled,field.remark,'_main_remark');
        	    }else if(field.boardroomFileList != null && field.boardroomFileList != ''){
	        			//附件上传
	        		itemContent += '<item style="col-width:100,*;padding:0;margin:0;"><col style="background:#f9f9f9;margin:10;padding:10;"><row>'+mustfilled_view+'<label style="align:left;font-size:16;color:#555555">' + field.boardroomFileList.boardroomFileName + ':</label>'+
	        		'</row></col><col id="fileRow" style="padding:10;margin:10;">';
	        		itemContent += '<row  onclick="doRelatedAcc(this,\'fileRow\',\'boardroomFile\')"><icon src="mail_addfu.png" style="width:28;height:28;" onclick="doRelatedAcc(this,\'fileRow\',\'boardroomFile\')"/></row>';
	        	    itemContent += '</col></item>';
	          	}
	        }
	        
	        var remindIndex = 0;
	        function getRemindType(){   //提醒方式有几种
	               var remind_im = '';
	               for(var index=0;index<parseInt(remindIndex);index++){
	                  if($('_main_remind_im'+index).checked == true && !$('_main_remind_im'+index).value == ''){
		                   if(remind_im==''){
		        	   		    remind_im = $('_main_remind_im'+index).value;
			        	   }else if($('_main_remind_im'+index).value == 'on'){  
			        	   		//不处理
			        	   }else{
			        	   		remind_im += ('|'+$('_main_remind_im'+index).value); 
			        	   }
		               }
		              // alert(remind_im);
	               }
	               return remind_im;
	             
	        }
	        
	        function getAddrOrPoints(){  //地点与点数切换
	             var _main_boardroomName = $('_main_boardroomName').value;
	             var boardroomArr = _main_boardroomName.split('|');
	             var addrOrPointsFlag = '';  //1显示点数，其他显示地点
	             if(boardroomArr.length>3){
	                 addrOrPointsFlag = boardroomArr[3];
	             }
	             if('1'==addrOrPointsFlag){
	             	$('addrId').css('display','none');
	             	$('pointsId').css('display','');
	             	mustFillCon.splice(parseInt(getAddrOrPointsIndex('地点;_main_addr')),'1');
	             	mustFillCon.push('点数;_main_points');
	             	isvideoFlag = 'yes';
	             	$('_main_addr').value='';
	             	maxNumber = boardroomArr[2];
	             }else{
	                $('addrId').css('display','');
	             	$('pointsId').css('display','none');
	             	mustFillCon.splice(parseInt(getAddrOrPointsIndex('点数;_main_points')),'1');
	             	mustFillCon.push('地点;_main_addr');
	             	isvideoFlag = 'no';
	             	$('_main_points').value='';
	             }
	        }
	        
	        function getAddrOrPointsIndex(fieldName){
	               if(mustFillCon&&mustFillCon.length>0){
	               		 for(var index=0;index<mustFillCon.length;index++){
	               		 	if(mustFillCon[index]==fieldName){
	               		 		return index;
	               		 	}
	               		 }
	               }
	        }
	        
	        // 选择用户
	        var userIdConIdVal;
	        var userNameConIdVal;
	        function selectUser(userIdConId,userNameConId,range,type){
	        	userIdConIdVal = userIdConId;
	        	userNameConIdVal = userNameConId;
		        storage.setItem('sys_selectuser_range',range);
		        storage.setItem('sys_selectuser_userids',$(userIdConIdVal).value);
		        storage.setItem('sys_selectuser_usernames',$(userNameConIdVal).value);
		        storage.setItem('sys_selectuser_returnfuc','setUserInfo');
		        if('0' == type){
				    $page.open('../public/selectSingleUser.xml', {animation:'down-to-up'});
		        }else if('1' == type){
				    $page.open('../public/selectUser.xml', {animation:'down-to-up'});
		        }else if('2' == type){
				    $page.open('../public/selectSingleOrg.xml', {animation:'down-to-up'});
		        }else if('3' == type){
				    $page.open('../public/selectOrg.xml', {animation:'down-to-up'});
		        }
			}
	        
	        function compareTime(boardTime){
	            var boardTimeArr = boardTime.split('');
	        	if(boardTimeArr[0]== '0'){
	        	        return  boardTimeArr[1];
	        	}else{
	        			return boardTime;
	        	}
	        	
	        }
	        
	        // 设置选人值
	        function setUserInfo(id,name){
	        	$(userIdConIdVal).value =  id;
	        	$(userNameConIdVal).value = name;
	        }
	        
			// 发送流程 
			function sendFlow(){
				//表单验证
				if(!checkForm()){
					return false;
				}
				if(isvideoFlag == 'yes'){
					var _main_points = $('_main_points').value;
					if(isNaN($('_main_points').value)){
						alert('点数请输入数字！');
						return false;
					}
					if(parseInt(_main_points) > parseInt(maxNumber)){
						alert("最大点数不能超过"+maxNumber);
						return false;
					}
				}
				var startTime = $('_main_startMinute').value;
				var endTime = $('_main_endMinute').value;
				var startTimeArr = startTime.split(':');
				var endTimeArr = endTime.split(':');
				var ymd = $('_main_destineDate').value;
				var dataArr = ymd.split('-');
				var oDate = new Date();           //实例一个时间对象；
				var year = oDate.getFullYear();   //获取系统的年；
				var month = oDate.getMonth()+1;   //获取系统月份，由于月份是从0开始计算，所以要加1
				var hours = oDate.getHours(); //获取系统时
				var minute = oDate.getMinutes(); //分
				var date = oDate.getDate(); // 获取系统日
				if(parseInt(dataArr[0])<parseInt(year)){
					if(!confirm('会议时间已经过期,是否预定？')){
					    return false;
					}
				}else if(parseInt(dataArr[0]) == parseInt(year)){
					if(parseInt(compareTime(dataArr[1]))<parseInt(month)){
						if(!confirm('会议时间已经过期,是否预定？')){
						    return false;
						}
					}else if(parseInt(compareTime(dataArr[1])) == parseInt(month)){  //年月都相等
						if(parseInt(compareTime(dataArr[2]))<parseInt(date)){
							if(!confirm('会议时间已经过期,是否预定？')){
							    return false;
							}
						}else if(parseInt(compareTime(dataArr[2])) == parseInt(date)){  //年月日都相等
							if(parseInt(compareTime(startTimeArr[0]))<parseInt(hours)){
								if(!confirm('会议时间已经过期,是否预定？')){
								    return false;
								}
							}else if(parseInt(compareTime(startTimeArr[0])) == parseInt(hours)){  //年月日时都相等
								if(parseInt(compareTime(startTimeArr[1]))<parseInt(minute)){
									if(!confirm('会议时间已经过期,是否预定？')){
									    return false;
									}
								}
							}
						}
					}
				}
				
				if(startTimeArr[0] > endTimeArr[0]){
					hint('预定结束时间不得小于或等于开始时间，请调整！');
					return;
				}else if(startTimeArr[0] == endTimeArr[0]){
					if(startTimeArr[1] >= endTimeArr[1]){
						hint('预定结束时间不得小于或等于开始时间，请调整！');
						return;
					}
				}
				
				for(var i=0;i<boardDateIndex;i++){
				   if($('_main_startMinute'+i)!=null && $('_main_startMinute'+i)!='' && $('_main_startMinute'+i)!=undefined){
				   	    var main_startTime = $('_main_startMinute'+i).value;
						var main_endTime = $('_main_endMinute'+i).value;
						var main_startTimeArr = main_startTime.split(':');
						var main_endTimeArr = main_endTime.split(':');
						if(main_startTimeArr[0] > main_endTimeArr[0]){
							hint('预定结束时间不得小于或等于开始时间，请调整！');
							return;
						}else if(main_startTimeArr[0] == main_endTimeArr[0]){
							if(main_startTimeArr[1] >= main_endTimeArr[1]){
								hint('预定结束时间不得小于或等于开始时间，请调整！');
								return;
							}
						}
				   }
				}
				$('boardDateIndexId').value = boardDateIndex+"";
				$('sendForm').action = evoUrl + '/ezOffice/boardroom/selectImpropriateTime.do';  //时间是否被占用
				$('sendForm').submit(function(data) {
					if(!data){
						alert('获取会议申请时间判断失败！');
						return false;
					}
					var dataJson = eval('('+data+')');
					if(dataJson.logonerror &&dataJson.logonerror=='1'){
		         		alert("该账号已在设备"+dataJson.deviceId+"上登录");
	          			$page.open('../index.xml',{target:'_self'});
                       return;
                    }
					var result = dataJson.message.result;
					if(result == '1'){   //返回成功
					    if(dataJson.data.isConflict == '0'){  //没有被占用，-1被占用
					    	sendForm();
					    }else{
					    	alert('时间被占用，请重新选择！');	
					    }
					}else{
						alert('保存表单失败！');				
					}
	            }, function(error) {
	                alert('提交失败！');
	            });
			}
			
			function sendForm(){
			    var remindType = getRemindType();
			    $('_main_remind_im').value = remindType;
				$('sendForm').action = evoUrl + '/ezOffice/boardroom/sendmeet.do';
				$('sendForm').submit(function(data) {
					if(!data){
						alert('保存表单失败！');
						return false;
					}
					var dataJson = eval('('+data+')');
					if(dataJson.logonerror &&dataJson.logonerror=='1'){
		         		alert("该账号已在设备"+dataJson.deviceId+"上登录");
	          			$page.open('../index.xml',{target:'_self'});
                        return;
                    }
					var result = dataJson.message.result;
					if(result == '1'){
						var infoid = dataJson.data.infoid;
						var processId = decodeURIComponent($param['processId']);
					//	var mainLinkFile = '/defaultroot/boardRoom!selectBoardroomApplyView.action';
					 //   var mainLinkFile = encodeURIComponent('boardRoom!selectBoardroomApplyView.action?type=modi');
					 //   alert(mainLinkFile);
						var model = $param['model'];
						var fromXml = $param['fromXml'];
						$page.open('workflow_first_send.xml?processId='+encodeURIComponent(processId)+'&businessId='+infoid+'&model='+model+'&fromXml='+fromXml+'&mainLinkFile=meet',
						{animation:'down-to-up'});
					}else{
						alert('保存表单失败！');					
					}
	            }, function(error) {
	                alert('提交失败！');
	            });
			}
			
			
				
        ]]>
</script>
    <page>
        <title style="background:#3daffe;tint-color:white">
            <left>
            	<button role="back"></button>
            </left>
            <center><label id="centerTitle"></label></center>
        </title>
           <content style="background:white" id="content_form">
			   <form id="sendForm" multipart="true" prompt="请稍后...">
					<list id="content_form_list">
						<item style="display:none">
							<row>
								<input id="sysPageId" type="hidden" name="__sys_pageId" value="" />
								<input id="processId" type="hidden" name="processId" value="" />
								<input id="operateType" type="hidden"  name="operateType" value="1" />
								<input id="__sys_formType" type="hidden" name="__sys_formType" value="form" />
								<input id="boardDateIndexId" type="hidden" name="boardDateIndexNum" value="" />
								<input type="hidden"  name="uploadPath" value="boardroom" /> 
							</row>
						</item>
					</list>
			   </form>
           </content>
		<footer id="footer" style="background:#F9F9F9">
			<list type="toolbar" id="footer_list">
			</list>
        </footer>
    </page>
</imag>